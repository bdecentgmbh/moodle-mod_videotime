{"version":3,"file":"comment.min.js","sources":["../src/comment.js"],"sourcesContent":["/*\n * Change comments\n *\n * @package    videotimetab_chat\n * @module     videotimetab_chat/refresh\n * @copyright  2022 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from \"core/ajax\";\nimport Notification from \"core/notification\";\nimport Log from \"core/log\";\n\nexport default {\n\n    /**\n     * Listen for comment actions\n     *\n     * @param {int} contextid Context id of module\n     * @param {string} selector Content location to replace\n     * @param {int} instanceid Context instance id\n     */\n    init: function(contextid, selector, instanceid) {\n        const observer = new ResizeObserver((entries) => {\n            for (const entry of entries) {\n                const comments = entry.target.querySelector('.videotimetab_chat');\n                if (comments && comments.scrollHeight && comments.scrollTop == 0) {\n                    Log.debug(comments.scrollHeight);\n                    comments.scrollTop = comments.scrollHeight;\n                }\n            }\n        });\n        observer.observe(document.querySelector(selector));\n        document.querySelector(selector).addEventListener('click', (e) => {\n            const button = e.target.closest('[data-type=\"comments\"] [data-action]');\n            if (button) {\n                const textarea = button.closest('[data-type=\"comments\"]').querySelector('textarea');\n                e.preventDefault();\n                e.stopPropagation();\n                switch (button.getAttribute('data-action')) {\n                    case 'addcomment':\n                        if (textarea.textLength) {\n                            Ajax.call([{\n                                methodname: 'videotimetab_chat_add_comments',\n                                args: {\n                                    comments: [{\n                                        content: textarea.value,\n                                        contextlevel: 'module',\n                                        instanceid: instanceid,\n                                        itemid: 0,\n                                        component: 'videotimetab_chat',\n                                        area: 'chat'\n                                    }],\n                                },\n                                fail: Notification.exception,\n                                done: () => {\n                                    textarea.value = '';\n                                }\n                            }]);\n                        }\n                        break;\n                    case 'delete':\n                        Ajax.call([{\n                            contextid: contextid,\n                            methodname: 'videotimetab_chat_delete_comments',\n                            args: {\n                                comments: [\n                                    button.closest('[data-comment]').getAttribute('data-comment')\n                                ],\n                            },\n                            fail: Notification.exception,\n                        }]);\n                        break;\n                }\n            }\n        });\n    }\n};\n"],"names":["init","contextid","selector","instanceid","ResizeObserver","entries","entry","comments","target","querySelector","scrollHeight","scrollTop","debug","observe","document","addEventListener","e","button","closest","textarea","preventDefault","stopPropagation","getAttribute","textLength","call","methodname","args","content","value","contextlevel","itemid","component","area","fail","Notification","exception","done"],"mappings":";;;;;;;;4NAae,CASXA,KAAM,SAASC,UAAWC,SAAUC,YACf,IAAIC,gBAAgBC,cAC5B,MAAMC,SAASD,QAAS,OACnBE,SAAWD,MAAME,OAAOC,cAAc,sBACxCF,UAAYA,SAASG,cAAsC,GAAtBH,SAASI,yBAC1CC,MAAML,SAASG,cACnBH,SAASI,UAAYJ,SAASG,kBAIjCG,QAAQC,SAASL,cAAcP,WACxCY,SAASL,cAAcP,UAAUa,iBAAiB,SAAUC,UAClDC,OAASD,EAAER,OAAOU,QAAQ,2CAC5BD,OAAQ,OACFE,SAAWF,OAAOC,QAAQ,0BAA0BT,cAAc,mBACxEO,EAAEI,iBACFJ,EAAEK,kBACMJ,OAAOK,aAAa,oBACnB,aACGH,SAASI,0BACJC,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CACFnB,SAAU,CAAC,CACPoB,QAASR,SAASS,MAClBC,aAAc,SACd1B,WAAYA,WACZ2B,OAAQ,EACRC,UAAW,oBACXC,KAAM,UAGdC,KAAMC,sBAAaC,UACnBC,KAAM,KACFjB,SAASS,MAAQ,iBAK5B,uBACIJ,KAAK,CAAC,CACPvB,UAAWA,UACXwB,WAAY,oCACZC,KAAM,CACFnB,SAAU,CACNU,OAAOC,QAAQ,kBAAkBI,aAAa,kBAGtDW,KAAMC,sBAAaC"}