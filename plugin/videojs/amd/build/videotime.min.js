<<<<<<< HEAD
define ("videotimeplugin_videojs/videotime",["jquery","mod_videotime/videotime","core/log","core/notification","media_videojs/video-lazy","media_videojs/Youtube-lazy"],function(a,b,c,d,e){function f(a,c,d,e,f){b.call(this,a,c,d,e,f)}f.prototype=Object.create(b.prototype);f.prototype.constructor=f;f.prototype.initialize=function(){var a=this;c.debug("Initializing Video Time "+this.elementId);var b=this.instance,f={autoplay:+b.autoplay,controls:+b.controls,sources:[{type:b.type,src:b.vimeo_url}],loop:+b.option_loop,fluid:+b.responsive,playsinline:+b.playsinline,playbackRates:+b.speed?[.5,.75,1,1.25,1.5,2]:[1],muted:+b.muted};if("video/youtube"===b.type){f.techOrder=["youtube"]}if(!+b.responsive&&+b.height&&+b.width){f.height=+b.height;f.width=+b.width}c.debug("Initializing VideoJS player with options:");c.debug(f);this.player=new e(this.elementId,f);this.player.on("loadedmetadata",function(){if(!b.resume_playback||0>=b.resume_time||a.resumed){return!0}var d=a.getPlayer().duration(),e=b.resume_time;if(e+1>=Math.floor(d)){c.debug("VIDEO_TIME video finished, resuming at start of video.");e=0}c.debug("VIDEO_TIME duration is "+d);c.debug("VIDEO_TIME resuming at "+e);if(e){setTimeout(function(){a.setCurrentPosition(e)},10)}return!0});var g=new URL(window.location.href),h=g.searchParams.get("q"),j=(g.searchParams.get("time")||"").match(/^([0-9]+:){0,2}([0-9]+)(\.[0-9]+)$/);if(j){this.setStartTime(j[0]).then(function(){if(h&&window.find){window.find(h)}return!0}).catch(d.exception)}else if(h&&window.find){window.find(h)}this.addListeners();for(var k=0,i;k<this.plugins.length;k++){i=this.plugins[k];i.initialize(this,b)}return!0};f.prototype.addListeners=function(){var b=this;a(a("#"+this.elementId).closest(".videotimetabs")).each(function(b,c){a(c).find("[data-action=\"cue\"]").each(function(a,b){var c=b.getAttribute("data-start"),e=c.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\.[0-9]+))/);if(e){this.player.addCuePoint(3600*+(e[3]||0)+60*+(e[5]||0)+ +e[6],{starttime:c}).catch(d.exeception)}}.bind(this));this.player.on("cuepoint",function(b){if(b.data.starttime){a(c).find(".videotime-highlight").removeClass("videotime-highlight");a(c).find("[data-action=\"cue\"][data-start=\""+b.data.starttime+"\"]").closest(".row").addClass("videotime-highlight");a(".videotime-highlight").each(function(){if(this.offsetTop){this.parentNode.scrollTo({top:this.offsetTop-50,left:0,behavior:"smooth"})}})}})}.bind(this));if(!this.player){c.debug("Player was not properly initialized for course module "+this.cmId);return}this.player.on("play",function(){if(!b.played){if(b.hasPro){b.startWatchInterval()}b.view()}return!0});if(!this.hasPro){return}this.player.on("play",function(){this.playing=!0;c.debug("VIDEO_TIME play")}.bind(this));this.player.on("playing",function(){this.playing=!0;c.debug("VIDEO_TIME playing")}.bind(this));this.player.on("pause",function(){this.playing=!1;c.debug("VIDEO_TIME pause")}.bind(this));this.player.on("stalled",function(){this.playing=!1;c.debug("VIDEO_TIME stalled")}.bind(this));this.player.on("suspend",function(){this.playing=!1;c.debug("VIDEO_TIME suspend")}.bind(this));this.player.on("abort",function(){this.playing=!1;c.debug("VIDEO_TIME abort")}.bind(this));this.player.on("playbackrateschange",function(){this.playbackRate=this.player.playbackRate()}.bind(this));this.player.on("timeupdate",function(){this.currentTime=this.player.currentTime();this.percent=this.currentTime/this.player.duration();c.debug("VIDEO_TIME timeupdate. Percent: "+this.percent+". Current time: "+this.currentTime)}.bind(this));this.player.on("ended",this.handleEnd.bind(this));this.player.on("pause",this.handleEnd.bind(this));if(this.player.options().responsive){var e=new ResizeObserver(function(){b.player.height(b.player.videoHeight()/b.player.videoWidth()*b.player.currentWidth())});e.observe(document.querySelector("#"+this.elementId))}};f.prototype.setStartTime=function(a){var b=a.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\.[0-9]+))/);if(b){this.resumeTime=3600*+(b[3]||0)+60*+(b[5]||0)+ +b[6];return this.player.currentTime(this.resumeTime)}c.debug("Set start time:"+a);return this.player.currentTime()};f.prototype.getDuration=function(){var a=this;return new Promise(function(b){b(a.player.duration());return!0})};f.prototype.getPlaybackRate=function(){var a=this;return new Promise(function(b){b(a.player.playbackRate());return!0})};f.prototype.setCurrentPosition=function(a){var b=this;return new Promise(function(c){c(b.player.currentTime(a));return!0})};f.prototype.getCurrentPosition=function(){var a=this;return new Promise(function(b){b(a.player.currentTime());return!0})};return f});
//# sourceMappingURL=videotime.min.js.map
=======
define("videotimeplugin_videojs/videotime",["exports","jquery","mod_videotime/videotime","core/log","core/notification","media_videojs/video-lazy","media_videojs/Youtube-lazy"],(function(_exports,_jquery,_videotime,_log,_notification,_videoLazy,_YoutubeLazy){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * Video time player specific js
   *
   * @package    videotimeplugin_videojs
   * @module     videotimeplugin_videojs/videotime
   * @copyright  2022 bdecent gmbh <https://bdecent.de>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_videotime=_interopRequireDefault(_videotime),_log=_interopRequireDefault(_log),_notification=_interopRequireDefault(_notification),_videoLazy=_interopRequireDefault(_videoLazy);class VideoTime extends _videotime.default{initialize(){_log.default.debug("Initializing Video Time "+this.elementId);const instance=this.instance,options={autoplay:Number(instance.autoplay),controls:Number(instance.controls),sources:[{type:instance.type,src:instance.vimeo_url}],loop:Number(instance.option_loop),fluid:Number(instance.responsive),playsinline:Number(instance.playsinline),playbackRates:Number(instance.speed)?[.5,.75,1,1.25,1.5,2]:[1],muted:Number(instance.muted)};"video/youtube"===instance.type&&(options.techOrder=["youtube"]),!Number(instance.responsive)&&Number(instance.height)&&Number(instance.width)&&(options.height=Number(instance.height),options.width=Number(instance.width)),_log.default.debug("Initializing VideoJS player with options:"),_log.default.debug(options),this.player=new _videoLazy.default(this.elementId,options),this.player.on("loadedmetadata",(()=>{if(!instance.resume_playback||instance.resume_time<=0||this.resumed)return!0;let duration=this.getPlayer().duration(),resumeTime=instance.resume_time;return resumeTime+1>=Math.floor(duration)&&(_log.default.debug("VIDEO_TIME video finished, resuming at start of video."),resumeTime=0),_log.default.debug("VIDEO_TIME duration is "+duration),_log.default.debug("VIDEO_TIME resuming at "+resumeTime),resumeTime&&setTimeout((()=>{this.setCurrentPosition(resumeTime)}),10),!0})),this.handleStartTime(),this.addListeners();for(let i=0;i<this.plugins.length;i++){this.plugins[i].initialize(this,instance)}return!0}async addListeners(){if((0,_jquery.default)((0,_jquery.default)("#"+this.elementId).closest(".videotimetabs")).each(function(i,tabs){(0,_jquery.default)(tabs).find('[data-action="cue"]').each(async function(index,anchor){let starttime=anchor.getAttribute("data-start"),time=starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\.[0-9]+))/);if(time)try{await this.player.addCuePoint(3600*Number(time[3]||0)+60*Number(time[5]||0)+Number(time[6]),{starttime:starttime})}catch(e){_notification.default.exception(e)}}.bind(this)),this.player.on("cuepoint",(function(event){event.data.starttime&&((0,_jquery.default)(tabs).find(".videotime-highlight").removeClass("videotime-highlight"),(0,_jquery.default)(tabs).find('[data-action="cue"][data-start="'+event.data.starttime+'"]').closest(".row").addClass("videotime-highlight"),(0,_jquery.default)(".videotime-highlight").each((function(){this.offsetTop&&this.parentNode.scrollTo({top:this.offsetTop-50,left:0,behavior:"smooth"})})))}))}.bind(this)),this.player){if(this.player.on("play",(()=>(this.played||(this.hasPro&&this.startWatchInterval(),this.view()),!0))),this.hasPro&&(this.player.on("play",function(){this.playing=!0,_log.default.debug("VIDEO_TIME play")}.bind(this)),this.player.on("playing",function(){this.playing=!0,_log.default.debug("VIDEO_TIME playing")}.bind(this)),this.player.on("pause",function(){this.playing=!1,_log.default.debug("VIDEO_TIME pause")}.bind(this)),this.player.on("stalled",function(){this.playing=!1,_log.default.debug("VIDEO_TIME stalled")}.bind(this)),this.player.on("suspend",function(){this.playing=!1,_log.default.debug("VIDEO_TIME suspend")}.bind(this)),this.player.on("abort",function(){this.playing=!1,_log.default.debug("VIDEO_TIME abort")}.bind(this)),this.player.on("playbackrateschange",function(){this.playbackRate=this.player.playbackRate()}.bind(this)),this.player.on("timeupdate",function(){this.currentTime=this.player.currentTime(),this.percent=this.currentTime/this.player.duration(),_log.default.debug("VIDEO_TIME timeupdate. Percent: "+this.percent+". Current time: "+this.currentTime)}.bind(this)),this.player.on("ended",this.handleEnd.bind(this)),this.player.on("pause",this.handlePause.bind(this)),this.player.options().responsive)){new ResizeObserver((()=>{this.player.height(this.player.videoHeight()/this.player.videoWidth()*this.player.currentWidth())})).observe(document.querySelector("#"+this.elementId))}}else _log.default.debug("Player was not properly initialized for course module "+this.cmId)}async setStartTime(starttime){let time=starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\.[0-9]+))/);return time?(this.resumeTime=3600*Number(time[3]||0)+60*Number(time[5]||0)+Number(time[6]),await this.player.currentTime(this.resumeTime)):(_log.default.debug("Set start time:"+starttime),await this.player.currentTime())}getDuration(){return new Promise((resolve=>(resolve(this.player.duration()),!0)))}getPlaybackRate(){return new Promise((resolve=>(resolve(this.player.playbackRate()),!0)))}setCurrentPosition(secs){return new Promise((resolve=>(resolve(this.player.currentTime(secs)),!0)))}async getCurrentPosition(){let position=await this.player.currentTime();return this.plugins.forEach((plugin=>{position=plugin.getCurrentPosition(position)})),position}getPaused(){return this.player.paused()}}return _exports.default=VideoTime,_exports.default}));

//# sourceMappingURL=videotime.min.js.map
>>>>>>> 570d6bf (VID-857: Automate go to next activity with VideoJS)
