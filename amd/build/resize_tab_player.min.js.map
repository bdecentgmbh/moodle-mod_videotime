{"version":3,"file":"resize_tab_player.min.js","sources":["../src/resize_tab_player.js"],"sourcesContent":["/*\n * Position the Vimeo player within tab layout\n *\n * @package    mod_videotime\n * @module     mod_videotime/resize_tab_player\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_videotime/resize_tab_player\n */\n define(['mod_videotime/player', 'core/notification'], function(Player, Notification) {\n\n    var resizeTabPlayer = function() {\n        this.initialize();\n    };\n\n    resizeTabPlayer.prototype.column = '';\n\n    /**\n     * Intialize listener\n     */\n    resizeTabPlayer.prototype.initialize = function() {\n        var self = this;\n        let observer = new ResizeObserver(self.resize),\n        mutationobserver = new MutationObserver(self.resize);\n        mutationobserver.observe(document.querySelector('#page-content'), {subtree: true, childList: true});\n        document.querySelectorAll('.instance-container, div.videotime-tab-instance').forEach((container) => {\n            observer.observe(container);\n        });\n        self.resize();\n        document.querySelectorAll('.videotime-tab-instance').forEach((instance) => {\n            instance.style.position = 'absolute';\n        });\n\n        window.removeEventListener('mousemove', self.mousemoveHandler);\n        window.addEventListener('mousemove', self.mousemoveHandler);\n\n        window.removeEventListener('dragstart', self.dragstartHandler);\n        window.addEventListener('dragstart', self.dragstartHandler);\n\n        window.removeEventListener('mouseup', self.dragendHandler);\n        window.addEventListener('mouseup', self.dragendHandler);\n\n        window.removeEventListener('click', self.cueVideo);\n        window.addEventListener('click', self.cueVideo);\n    };\n\n    /**\n     * Adjust player position when the page configuration is changed\n     */\n    resizeTabPlayer.prototype.resize = function() {\n        document.querySelectorAll('.instance-container').forEach((container) => {\n            if (!container.offsetWidth) {\n                // Ignore if it is not visible.\n                return;\n            }\n            container.closest('.videotimetabs').querySelectorAll('.videotime-tab-instance .vimeo-embed iframe')\n                .forEach((iframe) => {\n            let instance = iframe.closest('.videotime-tab-instance'),\n                content = iframe.closest('.tab-content');\n                Object.assign(instance.style, {\n                    top: container.offsetTop + 'px',\n                    left: container.offsetLeft + 'px',\n                    width: container.offsetWidth + 'px'\n                });\n                container.style.minHeight = iframe.closest('.videotime-tab-instance').offsetHeight + 'px';\n                content.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n                    Object.assign(cover.style, {\n                        height: content.offsetHeight + 'px',\n                        left: content.offsetLeft + 'px',\n                        top: content.offsetTop + 'px',\n                        width: content.offsetWidth + 'px'\n                    });\n                });\n            });\n        });\n    };\n\n    /**\n     * Reset handle when drag ends\n     */\n    resizeTabPlayer.prototype.dragendHandler = function() {\n        document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n            cover.style.display = 'none';\n        });\n    };\n\n    /**\n     * Prepare to drag divider\n     *\n     * @param {event} e mouse event\n     */\n    resizeTabPlayer.prototype.dragstartHandler = function(e) {\n        if (e.target.classList.contains('videotimetab-resize-handle')) {\n            this.column = e.target.closest('.tab-pane').querySelector('.videotimetab-resize');\n            e.stopPropagation();\n            e.preventDefault();\n            document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n                cover.style.display = 'block';\n            });\n        }\n    };\n\n    /**\n     * Resize the content and player to mouse location\n     *\n     * @param {event} e mouse event\n     */\n    resizeTabPlayer.prototype.mousemoveHandler = function(e) {\n        document.querySelectorAll('.videotimetab-resize-handle').forEach((h) => {\n            if (h.closest('.tab-pane') && document.querySelector('.videotime-tab-instance-cover').style.display == 'block') {\n                this.column.style.width = e.pageX - this.column.getBoundingClientRect().left + 'px';\n            }\n        });\n    };\n\n    /**\n     * Move video to new time when link clicked\n     *\n     * @param {event} e mouse event\n     */\n    resizeTabPlayer.prototype.cueVideo = function(e) {\n        if (e.target.matches('[data-action=\"cue\"]')) {\n            let starttime = e.target.closest('a').getAttribute('data-start'),\n                time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+))/),\n                iframe = e.target.closest('.videotimetabs').querySelector('.vimeo-embed iframe'),\n                player = new Player(iframe);\n            e.preventDefault();\n            e.stopPropagation();\n            if (time) {\n                player\n                .setCurrentTime(3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]))\n                .then(player.play.bind(player))\n                .catch(Notification.exception);\n            }\n        }\n    };\n\n    return {\n        init: function() {\n            return new resizeTabPlayer();\n        }\n    };\n});\n"],"names":["define","Player","Notification","resizeTabPlayer","initialize","prototype","column","observer","ResizeObserver","this","resize","MutationObserver","observe","document","querySelector","subtree","childList","querySelectorAll","forEach","container","instance","style","position","window","removeEventListener","mousemoveHandler","addEventListener","dragstartHandler","dragendHandler","cueVideo","offsetWidth","closest","iframe","content","Object","assign","top","offsetTop","left","offsetLeft","width","minHeight","offsetHeight","cover","height","display","e","target","classList","contains","stopPropagation","preventDefault","h","pageX","getBoundingClientRect","matches","time","getAttribute","match","player","setCurrentTime","Number","then","play","bind","catch","exception","init"],"mappings":"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"}