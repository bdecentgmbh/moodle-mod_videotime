{"version":3,"file":"resize_tab_player.min.js","sources":["../src/resize_tab_player.js"],"sourcesContent":["/*\n * Position the Vimeo player within tab layout\n *\n * @package    mod_videotime\n * @module     mod_videotime/resize_tab_player\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Player from \"mod_videotime/player\";\nimport Notification from \"core/notification\";\n\nlet column;\n\n/**\n * Intialize listener\n */\nexport const initialize = () => {\n    let observer = new ResizeObserver(resize),\n        mutationobserver = new MutationObserver(resize);\n    mutationobserver.observe(document.querySelector('#page-content'), {subtree: true, childList: true});\n    document.querySelectorAll('.instance-container, div.videotime-tab-instance').forEach((container) => {\n        observer.observe(container);\n    });\n    resize();\n    document.querySelectorAll('.videotime-tab-instance').forEach((instance) => {\n        instance.style.position = 'absolute';\n    });\n\n    window.removeEventListener('mousemove', mousemoveHandler);\n    window.addEventListener('mousemove', mousemoveHandler);\n\n    window.removeEventListener('dragstart', dragstartHandler);\n    window.addEventListener('dragstart', dragstartHandler);\n\n    window.removeEventListener('mouseup', dragendHandler);\n    window.addEventListener('mouseup', dragendHandler);\n\n    window.removeEventListener('click', cueVideo);\n    window.addEventListener('click', cueVideo);\n};\n\n/**\n * Adjust player position when the page configuration is changed\n */\nconst resize = () => {\n    document.querySelectorAll('.instance-container').forEach((container) => {\n        if (!container.offsetWidth) {\n            // Ignore if it is not visible.\n            return;\n        }\n        container.closest('.videotimetabs').querySelectorAll('.videotime-tab-instance .vimeo-embed iframe').forEach((iframe) => {\n            let instance = iframe.closest('.videotime-tab-instance');\n            Object.assign(instance.style, {\n                top: container.offsetTop + 'px',\n                left: container.offsetLeft + 'px',\n                width: container.offsetWidth + 'px'\n            });\n            container.style.minHeight = iframe.closest('.videotime-tab-instance').offsetHeight + 'px';\n            document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n                Object.assign(cover.style, {\n                    top: instance.style.top,\n                    left: instance.style.left,\n                    width: instance.style.width,\n                    height: instance.offsetHeight + 'px'\n                });\n            });\n        });\n    });\n};\n\n/**\n * Reset handle when drag ends\n */\nconst dragendHandler = () => {\n    document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n        cover.style.display = 'none';\n    });\n};\n\n/**\n * Prepare to drag divider\n *\n * @param {event} e mouse event\n */\nconst dragstartHandler = (e) => {\n    if (e.target.classList.contains('videotimetab-resize-handle')) {\n        column = e.target.closest('.tab-pane').querySelector('.videotimetab-resize');\n        e.stopPropagation();\n        e.preventDefault();\n        document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n            cover.style.display = 'block';\n        });\n    }\n};\n\n/**\n * Resize the content and player to mouse location\n *\n * @param {event} e mouse event\n */\nconst mousemoveHandler = (e) => {\n    document.querySelectorAll('.videotimetab-resize-handle').forEach((h) => {\n        if (h.closest('.tab-pane') && document.querySelector('.videotime-tab-instance-cover').style.display == 'block') {\n            column.style.width = e.pageX - column.getBoundingClientRect().left + 'px';\n        }\n    });\n};\n\n/**\n * Move video to new time when link clicked\n *\n * @param {event} e mouse event\n */\nconst cueVideo = (e) => {\n    if (e.target.matches('[data-action=\"cue\"]')) {\n        let starttime = e.target.closest('a').getAttribute('data-start'),\n            time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+))/),\n            iframe = e.target.closest('.videotimetabs').querySelector('.vimeo-embed iframe'),\n            player = new Player(iframe);\n        e.preventDefault();\n        e.stopPropagation();\n        if (time) {\n            player.setCurrentTime(\n                3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6])\n            ).then(player.play.bind(player)\n            ).catch(Notification.exception);\n        }\n    }\n};\n"],"names":["column","observer","ResizeObserver","resize","MutationObserver","observe","document","querySelector","subtree","childList","querySelectorAll","forEach","container","instance","style","position","window","removeEventListener","mousemoveHandler","addEventListener","dragstartHandler","dragendHandler","cueVideo","offsetWidth","closest","iframe","Object","assign","top","offsetTop","left","offsetLeft","width","minHeight","offsetHeight","cover","height","display","e","target","classList","contains","stopPropagation","preventDefault","h","pageX","getBoundingClientRect","matches","time","getAttribute","match","player","Player","setCurrentTime","Number","then","play","bind","catch","Notification","exception"],"mappings":";;;;;;;;SAYIA,0MAKsB,SAClBC,SAAW,IAAIC,eAAeC,QACX,IAAIC,iBAAiBD,QAC3BE,QAAQC,SAASC,cAAc,iBAAkB,CAACC,SAAS,EAAMC,WAAW,IAC7FH,SAASI,iBAAiB,mDAAmDC,SAASC,YAClFX,SAASI,QAAQO,cAErBT,SACAG,SAASI,iBAAiB,2BAA2BC,SAASE,WAC1DA,SAASC,MAAMC,SAAW,cAG9BC,OAAOC,oBAAoB,YAAaC,kBACxCF,OAAOG,iBAAiB,YAAaD,kBAErCF,OAAOC,oBAAoB,YAAaG,kBACxCJ,OAAOG,iBAAiB,YAAaC,kBAErCJ,OAAOC,oBAAoB,UAAWI,gBACtCL,OAAOG,iBAAiB,UAAWE,gBAEnCL,OAAOC,oBAAoB,QAASK,UACpCN,OAAOG,iBAAiB,QAASG,iBAM/BnB,OAAS,KACXG,SAASI,iBAAiB,uBAAuBC,SAASC,YACjDA,UAAUW,aAIfX,UAAUY,QAAQ,kBAAkBd,iBAAiB,+CAA+CC,SAASc,aACrGZ,SAAWY,OAAOD,QAAQ,2BAC9BE,OAAOC,OAAOd,SAASC,MAAO,CAC1Bc,IAAKhB,UAAUiB,UAAY,KAC3BC,KAAMlB,UAAUmB,WAAa,KAC7BC,MAAOpB,UAAUW,YAAc,OAEnCX,UAAUE,MAAMmB,UAAYR,OAAOD,QAAQ,2BAA2BU,aAAe,KACrF5B,SAASI,iBAAiB,iCAAiCC,SAASwB,QAChET,OAAOC,OAAOQ,MAAMrB,MAAO,CACvBc,IAAKf,SAASC,MAAMc,IACpBE,KAAMjB,SAASC,MAAMgB,KACrBE,MAAOnB,SAASC,MAAMkB,MACtBI,OAAQvB,SAASqB,aAAe,iBAU9Cb,eAAiB,KACnBf,SAASI,iBAAiB,iCAAiCC,SAASwB,QAChEA,MAAMrB,MAAMuB,QAAU,WASxBjB,iBAAoBkB,IAClBA,EAAEC,OAAOC,UAAUC,SAAS,gCAC5BzC,OAASsC,EAAEC,OAAOf,QAAQ,aAAajB,cAAc,wBACrD+B,EAAEI,kBACFJ,EAAEK,iBACFrC,SAASI,iBAAiB,iCAAiCC,SAASwB,QAChEA,MAAMrB,MAAMuB,QAAU,aAU5BnB,iBAAoBoB,IACtBhC,SAASI,iBAAiB,+BAA+BC,SAASiC,IAC1DA,EAAEpB,QAAQ,cAAyF,SAAzElB,SAASC,cAAc,iCAAiCO,MAAMuB,UACxFrC,OAAOc,MAAMkB,MAAQM,EAAEO,MAAQ7C,OAAO8C,wBAAwBhB,KAAO,UAU3ER,SAAYgB,OACVA,EAAEC,OAAOQ,QAAQ,uBAAwB,KAErCC,KADYV,EAAEC,OAAOf,QAAQ,KAAKyB,aAAa,cAC9BC,MAAM,gDACvBzB,OAASa,EAAEC,OAAOf,QAAQ,kBAAkBjB,cAAc,uBAC1D4C,OAAS,IAAIC,gBAAO3B,QACxBa,EAAEK,iBACFL,EAAEI,kBACEM,MACAG,OAAOE,eACH,KAAOC,OAAON,KAAK,IAAM,GAAK,GAAKM,OAAON,KAAK,IAAM,GAAKM,OAAON,KAAK,KACxEO,KAAKJ,OAAOK,KAAKC,KAAKN,SACtBO,MAAMC,sBAAaC"}