{"version":3,"file":"resize_tab_player.min.js","sources":["../src/resize_tab_player.js"],"sourcesContent":["/*\n * Position the Vimeo player within tab layout\n *\n * @package    mod_videotime\n * @module     mod_videotime/resize_tab_player\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Player from \"mod_videotime/player\";\nimport Notification from \"core/notification\";\n\nlet column;\n\n/**\n * Intialize listener\n */\nexport const initialize = () => {\n    let observer = new ResizeObserver(resize),\n        mutationobserver = new MutationObserver(resize);\n    mutationobserver.observe(document.querySelector('#page-content'), {subtree: true, childList: true});\n    document.querySelectorAll('.instance-container, div.videotime-tab-instance').forEach((container) => {\n        observer.observe(container);\n    });\n    document.querySelectorAll('.videotime-tab-instance').forEach((instance) => {\n        instance.style.position = 'absolute';\n    });\n    resize();\n\n    window.removeEventListener('mousemove', mousemoveHandler);\n    window.addEventListener('mousemove', mousemoveHandler);\n\n    window.removeEventListener('dragstart', dragstartHandler);\n    window.addEventListener('dragstart', dragstartHandler);\n\n    window.removeEventListener('mouseup', dragendHandler);\n    window.addEventListener('mouseup', dragendHandler);\n\n    window.removeEventListener('click', cueVideo);\n    window.addEventListener('click', cueVideo);\n};\n\n/**\n * Adjust player position when the page configuration is changed\n */\nconst resize = () => {\n    document.querySelectorAll('.instance-container').forEach((container) => {\n        if (!container.offsetWidth) {\n            // Ignore if it is not visible.\n            return;\n        }\n        container.closest('.videotimetabs').querySelectorAll('.videotime-tab-instance').forEach(() => {\n            let instance = container.closest('.videotimetabs').querySelector('.videotime-tab-instance'),\n                content = container.closest('.videotimetabs').querySelector('.tab-content');\n            Object.assign(instance.style, {\n                top: container.offsetTop + 'px',\n                left: container.offsetLeft + 'px',\n                maxWidth: container.offsetWidth + 'px',\n                width: container.offsetWidth + 'px'\n            });\n            container.style.minHeight = instance.offsetHeight + 5 + 'px';\n            container.closest('.videotimetabs').querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n                Object.assign(cover.style, {\n                    height: content.offsetHeight + 'px',\n                    left: content.offsetLeft + 'px',\n                    top: content.offsetTop + 'px',\n                    width: content.offsetWidth + 'px'\n                });\n            });\n        });\n    });\n};\n\n/**\n * Reset handle when drag ends\n */\nconst dragendHandler = () => {\n    document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n        cover.style.display = 'none';\n    });\n};\n\n/**\n * Prepare to drag divider\n *\n * @param {event} e mouse event\n */\nconst dragstartHandler = (e) => {\n    if (e.target.classList.contains('videotimetab-resize-handle')) {\n        column = e.target.closest('.tab-pane').querySelector('.videotimetab-resize');\n        e.stopPropagation();\n        e.preventDefault();\n        document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n            cover.style.display = 'block';\n        });\n    }\n};\n\n/**\n * Resize the content and player to mouse location\n *\n * @param {event} e mouse event\n */\nconst mousemoveHandler = (e) => {\n    document.querySelectorAll('.videotimetab-resize-handle').forEach((h) => {\n        if (h.closest('.tab-pane') && document.querySelector('.videotime-tab-instance-cover').style.display == 'block') {\n            column.style.width = e.pageX - column.getBoundingClientRect().left + 'px';\n        }\n    });\n};\n\n/**\n * Move video to new time when link clicked\n *\n * @param {event} e mouse event\n */\nconst cueVideo = (e) => {\n    if (e.target.closest('[data-action=\"cue\"]')) {\n        let starttime = e.target.closest('a').getAttribute('data-start'),\n            time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+)?)/),\n            iframe = e.target.closest('.videotimetabs').querySelector('.vimeo-embed iframe'),\n            player = new Player(iframe);\n        e.preventDefault();\n        e.stopPropagation();\n        if (time) {\n            player\n                .setCurrentTime(3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]))\n                .then(player.play.bind(player))\n                .catch(Notification.exception);\n        }\n    }\n};\n"],"names":["column","observer","ResizeObserver","resize","MutationObserver","observe","document","querySelector","subtree","childList","querySelectorAll","forEach","container","instance","style","position","window","removeEventListener","mousemoveHandler","addEventListener","dragstartHandler","dragendHandler","cueVideo","offsetWidth","closest","content","Object","assign","top","offsetTop","left","offsetLeft","maxWidth","width","minHeight","offsetHeight","cover","height","display","e","target","classList","contains","stopPropagation","preventDefault","h","pageX","getBoundingClientRect","time","getAttribute","match","iframe","player","Player","setCurrentTime","Number","then","play","bind","catch","Notification","exception"],"mappings":";;;;;;;;SAYIA,0MAKsB,SAClBC,SAAW,IAAIC,eAAeC,QACX,IAAIC,iBAAiBD,QAC3BE,QAAQC,SAASC,cAAc,iBAAkB,CAACC,SAAS,EAAMC,WAAW,IAC7FH,SAASI,iBAAiB,mDAAmDC,SAASC,YAClFX,SAASI,QAAQO,cAErBN,SAASI,iBAAiB,2BAA2BC,SAASE,WAC1DA,SAASC,MAAMC,SAAW,cAE9BZ,SAEAa,OAAOC,oBAAoB,YAAaC,kBACxCF,OAAOG,iBAAiB,YAAaD,kBAErCF,OAAOC,oBAAoB,YAAaG,kBACxCJ,OAAOG,iBAAiB,YAAaC,kBAErCJ,OAAOC,oBAAoB,UAAWI,gBACtCL,OAAOG,iBAAiB,UAAWE,gBAEnCL,OAAOC,oBAAoB,QAASK,UACpCN,OAAOG,iBAAiB,QAASG,iBAM/BnB,OAAS,KACXG,SAASI,iBAAiB,uBAAuBC,SAASC,YACjDA,UAAUW,aAIfX,UAAUY,QAAQ,kBAAkBd,iBAAiB,2BAA2BC,SAAQ,SAChFE,SAAWD,UAAUY,QAAQ,kBAAkBjB,cAAc,2BAC7DkB,QAAUb,UAAUY,QAAQ,kBAAkBjB,cAAc,gBAChEmB,OAAOC,OAAOd,SAASC,MAAO,CAC1Bc,IAAKhB,UAAUiB,UAAY,KAC3BC,KAAMlB,UAAUmB,WAAa,KAC7BC,SAAUpB,UAAUW,YAAc,KAClCU,MAAOrB,UAAUW,YAAc,OAEnCX,UAAUE,MAAMoB,UAAYrB,SAASsB,aAAe,EAAI,KACxDvB,UAAUY,QAAQ,kBAAkBd,iBAAiB,iCAAiCC,SAASyB,QAC3FV,OAAOC,OAAOS,MAAMtB,MAAO,CACvBuB,OAAQZ,QAAQU,aAAe,KAC/BL,KAAML,QAAQM,WAAa,KAC3BH,IAAKH,QAAQI,UAAY,KACzBI,MAAOR,QAAQF,YAAc,iBAU3CF,eAAiB,KACnBf,SAASI,iBAAiB,iCAAiCC,SAASyB,QAChEA,MAAMtB,MAAMwB,QAAU,WASxBlB,iBAAoBmB,IAClBA,EAAEC,OAAOC,UAAUC,SAAS,gCAC5B1C,OAASuC,EAAEC,OAAOhB,QAAQ,aAAajB,cAAc,wBACrDgC,EAAEI,kBACFJ,EAAEK,iBACFtC,SAASI,iBAAiB,iCAAiCC,SAASyB,QAChEA,MAAMtB,MAAMwB,QAAU,aAU5BpB,iBAAoBqB,IACtBjC,SAASI,iBAAiB,+BAA+BC,SAASkC,IAC1DA,EAAErB,QAAQ,cAAyF,SAAzElB,SAASC,cAAc,iCAAiCO,MAAMwB,UACxFtC,OAAOc,MAAMmB,MAAQM,EAAEO,MAAQ9C,OAAO+C,wBAAwBjB,KAAO,UAU3ER,SAAYiB,OACVA,EAAEC,OAAOhB,QAAQ,uBAAwB,KAErCwB,KADYT,EAAEC,OAAOhB,QAAQ,KAAKyB,aAAa,cAC9BC,MAAM,iDACvBC,OAASZ,EAAEC,OAAOhB,QAAQ,kBAAkBjB,cAAc,uBAC1D6C,OAAS,IAAIC,gBAAOF,QACxBZ,EAAEK,iBACFL,EAAEI,kBACEK,MACAI,OACKE,eAAe,KAAOC,OAAOP,KAAK,IAAM,GAAK,GAAKO,OAAOP,KAAK,IAAM,GAAKO,OAAOP,KAAK,KACrFQ,KAAKJ,OAAOK,KAAKC,KAAKN,SACtBO,MAAMC,sBAAaC"}