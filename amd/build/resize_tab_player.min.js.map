{"version":3,"file":"resize_tab_player.min.js","sources":["../src/resize_tab_player.js"],"sourcesContent":["/*\n * Position the Vimeo player within tab layout\n *\n * @package    mod_videotime\n * @module     mod_videotime/resize_tab_player\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Player from \"mod_videotime/player\";\nimport Notification from \"core/notification\";\n\nlet column;\n\n/**\n * Intialize listener\n */\nexport const initialize = () => {\n    let observer = new ResizeObserver(resize),\n        mutationobserver = new MutationObserver(resize);\n    mutationobserver.observe(document.body, {subtree: true, childList: true});\n    document.querySelectorAll('.instance-container, div.videotime-tab-instance').forEach((container) => {\n        observer.observe(container);\n    });\n    document.querySelectorAll('.videotime-tab-instance').forEach((instance) => {\n        instance.style.position = 'absolute';\n    });\n    resize();\n\n    window.removeEventListener('mousemove', mousemoveHandler);\n    window.addEventListener('mousemove', mousemoveHandler);\n\n    window.removeEventListener('dragstart', dragstartHandler);\n    window.addEventListener('dragstart', dragstartHandler);\n\n    window.removeEventListener('mouseup', dragendHandler);\n    window.addEventListener('mouseup', dragendHandler);\n\n    window.removeEventListener('click', cueVideo);\n    window.addEventListener('click', cueVideo);\n};\n\n/**\n * Adjust player position when the page configuration is changed\n */\nconst resize = () => {\n    document.querySelectorAll('.instance-container').forEach((container) => {\n        if (!container.offsetWidth) {\n            // Ignore if it is not visible.\n            return;\n        }\n        container.closest('.videotimetabs').querySelectorAll('.videotime-tab-instance').forEach((instance) => {\n            let content = container.closest('.videotimetabs').querySelector('.tab-content'),\n                i = 0;\n            Object.assign(instance.style, {\n                top: container.offsetTop + 'px',\n                left: container.offsetLeft + 'px',\n                maxWidth: container.offsetWidth + 'px',\n                width: container.offsetWidth + 'px'\n            });\n            container.closest('.videotimetabs').querySelectorAll('ul .nav-link').forEach(tab => {\n                i++;\n                if (tab.classList.contains('active')) {\n                    instance.setAttribute('data-tab', i);\n                }\n            });\n            container.style.minHeight = instance.offsetHeight + 5 + 'px';\n            container.closest('.videotimetabs').querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n                Object.assign(cover.style, {\n                    height: content.offsetHeight + 'px',\n                    left: content.offsetLeft + 'px',\n                    top: content.offsetTop + 'px',\n                    width: content.offsetWidth + 'px'\n                });\n            });\n        });\n    });\n};\n\n/**\n * Reset handle when drag ends\n */\nconst dragendHandler = () => {\n    document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n        cover.style.display = 'none';\n    });\n};\n\n/**\n * Prepare to drag divider\n *\n * @param {event} e mouse event\n */\nconst dragstartHandler = (e) => {\n    if (e.target.classList.contains('videotimetab-resize-handle')) {\n        column = e.target.closest('.tab-pane').querySelector('.videotimetab-resize');\n        e.stopPropagation();\n        e.preventDefault();\n        document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n            cover.style.display = 'block';\n        });\n    }\n};\n\n/**\n * Resize the content and player to mouse location\n *\n * @param {event} e mouse event\n */\nconst mousemoveHandler = (e) => {\n    document.querySelectorAll('.videotimetab-resize-handle').forEach((h) => {\n        if (h.closest('.tab-pane') && document.querySelector('.videotime-tab-instance-cover').style.display == 'block') {\n            column.style.width = e.pageX - column.getBoundingClientRect().left + 'px';\n        }\n    });\n};\n\n/**\n * Move video to new time when link clicked\n *\n * @param {event} e mouse event\n */\nconst cueVideo = async(e) => {\n    if (e.target.closest('[data-action=\"cue\"]')) {\n        const starttime = e.target.closest('a').getAttribute('data-start'),\n            time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+)?)/),\n            iframe = e.target.closest('.videotimetabs').querySelector('.vimeo-embed iframe');\n        if (iframe) {\n            const player = new Player(iframe);\n            e.preventDefault();\n            e.stopPropagation();\n            if (time) {\n                try {\n                    await player\n                        .setCurrentTime(3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]));\n                    player.play();\n                } catch (e) {\n                    Notification.exception(e);\n                }\n            }\n        } else {\n            const player = e.target.closest('.videotimetabs').querySelector('video');\n            e.preventDefault();\n            e.stopPropagation();\n            player.currentTime = 3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]);\n        }\n    }\n};\n"],"names":["column","observer","ResizeObserver","resize","MutationObserver","observe","document","body","subtree","childList","querySelectorAll","forEach","container","instance","style","position","window","removeEventListener","mousemoveHandler","addEventListener","dragstartHandler","dragendHandler","cueVideo","offsetWidth","closest","content","querySelector","i","Object","assign","top","offsetTop","left","offsetLeft","maxWidth","width","tab","classList","contains","setAttribute","minHeight","offsetHeight","cover","height","display","e","target","stopPropagation","preventDefault","h","pageX","getBoundingClientRect","async","time","getAttribute","match","iframe","player","Player","setCurrentTime","Number","play","exception","currentTime"],"mappings":";;;;;;;;SAYIA,0MAKsB,SAClBC,SAAW,IAAIC,eAAeC,QACX,IAAIC,iBAAiBD,QAC3BE,QAAQC,SAASC,KAAM,CAACC,SAAS,EAAMC,WAAW,IACnEH,SAASI,iBAAiB,mDAAmDC,SAASC,YAClFX,SAASI,QAAQO,cAErBN,SAASI,iBAAiB,2BAA2BC,SAASE,WAC1DA,SAASC,MAAMC,SAAW,cAE9BZ,SAEAa,OAAOC,oBAAoB,YAAaC,kBACxCF,OAAOG,iBAAiB,YAAaD,kBAErCF,OAAOC,oBAAoB,YAAaG,kBACxCJ,OAAOG,iBAAiB,YAAaC,kBAErCJ,OAAOC,oBAAoB,UAAWI,gBACtCL,OAAOG,iBAAiB,UAAWE,gBAEnCL,OAAOC,oBAAoB,QAASK,UACpCN,OAAOG,iBAAiB,QAASG,iBAM/BnB,OAAS,KACXG,SAASI,iBAAiB,uBAAuBC,SAASC,YACjDA,UAAUW,aAIfX,UAAUY,QAAQ,kBAAkBd,iBAAiB,2BAA2BC,SAASE,eACjFY,QAAUb,UAAUY,QAAQ,kBAAkBE,cAAc,gBAC5DC,EAAI,EACRC,OAAOC,OAAOhB,SAASC,MAAO,CAC1BgB,IAAKlB,UAAUmB,UAAY,KAC3BC,KAAMpB,UAAUqB,WAAa,KAC7BC,SAAUtB,UAAUW,YAAc,KAClCY,MAAOvB,UAAUW,YAAc,OAEnCX,UAAUY,QAAQ,kBAAkBd,iBAAiB,gBAAgBC,SAAQyB,MACzET,IACIS,IAAIC,UAAUC,SAAS,WACvBzB,SAAS0B,aAAa,WAAYZ,MAG1Cf,UAAUE,MAAM0B,UAAY3B,SAAS4B,aAAe,EAAI,KACxD7B,UAAUY,QAAQ,kBAAkBd,iBAAiB,iCAAiCC,SAAS+B,QAC3Fd,OAAOC,OAAOa,MAAM5B,MAAO,CACvB6B,OAAQlB,QAAQgB,aAAe,KAC/BT,KAAMP,QAAQQ,WAAa,KAC3BH,IAAKL,QAAQM,UAAY,KACzBI,MAAOV,QAAQF,YAAc,iBAU3CF,eAAiB,KACnBf,SAASI,iBAAiB,iCAAiCC,SAAS+B,QAChEA,MAAM5B,MAAM8B,QAAU,WASxBxB,iBAAoByB,IAClBA,EAAEC,OAAOT,UAAUC,SAAS,gCAC5BtC,OAAS6C,EAAEC,OAAOtB,QAAQ,aAAaE,cAAc,wBACrDmB,EAAEE,kBACFF,EAAEG,iBACF1C,SAASI,iBAAiB,iCAAiCC,SAAS+B,QAChEA,MAAM5B,MAAM8B,QAAU,aAU5B1B,iBAAoB2B,IACtBvC,SAASI,iBAAiB,+BAA+BC,SAASsC,IAC1DA,EAAEzB,QAAQ,cAAyF,SAAzElB,SAASoB,cAAc,iCAAiCZ,MAAM8B,UACxF5C,OAAOc,MAAMqB,MAAQU,EAAEK,MAAQlD,OAAOmD,wBAAwBnB,KAAO,UAU3EV,SAAW8B,MAAAA,OACTP,EAAEC,OAAOtB,QAAQ,uBAAwB,OAErC6B,KADcR,EAAEC,OAAOtB,QAAQ,KAAK8B,aAAa,cAChCC,MAAM,iDACvBC,OAASX,EAAEC,OAAOtB,QAAQ,kBAAkBE,cAAc,0BAC1D8B,OAAQ,OACFC,OAAS,IAAIC,gBAAOF,WAC1BX,EAAEG,iBACFH,EAAEE,kBACEM,eAEUI,OACDE,eAAe,KAAOC,OAAOP,KAAK,IAAM,GAAK,GAAKO,OAAOP,KAAK,IAAM,GAAKO,OAAOP,KAAK,KAC1FI,OAAOI,OACT,MAAOhB,yBACQiB,UAAUjB,QAG5B,OACGY,OAASZ,EAAEC,OAAOtB,QAAQ,kBAAkBE,cAAc,SAChEmB,EAAEG,iBACFH,EAAEE,kBACFU,OAAOM,YAAc,KAAOH,OAAOP,KAAK,IAAM,GAAK,GAAKO,OAAOP,KAAK,IAAM,GAAKO,OAAOP,KAAK"}