{"version":3,"sources":["../src/resize_tab_player.js"],"names":["column","initialize","observer","ResizeObserver","resize","mutationobserver","MutationObserver","observe","document","querySelector","subtree","childList","querySelectorAll","forEach","container","instance","style","position","window","removeEventListener","mousemoveHandler","addEventListener","dragstartHandler","dragendHandler","cueVideo","offsetWidth","closest","iframe","Object","assign","top","offsetTop","left","offsetLeft","width","minHeight","offsetHeight","cover","height","display","e","target","classList","contains","stopPropagation","preventDefault","h","pageX","getBoundingClientRect","matches","starttime","getAttribute","time","match","player","Player","setCurrentTime","then","play","bind","catch","Notification","exception"],"mappings":"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","sourcesContent":["/*\n * Position the Vimeo player within tab layout\n *\n * @package    mod_videotime\n * @module     mod_videotime/resize_tab_player\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Player from \"mod_videotime/player\";\nimport Notification from \"core/notification\";\n\nlet column;\n\n/**\n * Intialize listener\n */\nexport const initialize = () => {\n    let observer = new ResizeObserver(resize),\n        mutationobserver = new MutationObserver(resize);\n    mutationobserver.observe(document.querySelector('#page-content'), {subtree: true, childList: true});\n    document.querySelectorAll('.instance-container, div.videotime-tab-instance').forEach((container) => {\n        observer.observe(container);\n    });\n    resize();\n    document.querySelectorAll('.videotime-tab-instance').forEach((instance) => {\n        instance.style.position = 'absolute';\n    });\n\n    window.removeEventListener('mousemove', mousemoveHandler);\n    window.addEventListener('mousemove', mousemoveHandler);\n\n    window.removeEventListener('dragstart', dragstartHandler);\n    window.addEventListener('dragstart', dragstartHandler);\n\n    window.removeEventListener('mouseup', dragendHandler);\n    window.addEventListener('mouseup', dragendHandler);\n\n    window.removeEventListener('click', cueVideo);\n    window.addEventListener('click', cueVideo);\n};\n\n/**\n * Adjust player position when the page configuration is changed\n */\nconst resize = () => {\n    document.querySelectorAll('.instance-container').forEach((container) => {\n        if (!container.offsetWidth) {\n            // Ignore if it is not visible.\n            return;\n        }\n        container.closest('.videotimetabs').querySelectorAll('.videotime-tab-instance .vimeo-embed iframe').forEach((iframe) => {\n            let instance = iframe.closest('.videotime-tab-instance');\n            Object.assign(instance.style, {\n                top: container.offsetTop + 'px',\n                left: container.offsetLeft + 'px',\n                width: container.offsetWidth + 'px'\n            });\n            container.style.minHeight = iframe.closest('.videotime-tab-instance').offsetHeight + 'px';\n            document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n                Object.assign(cover.style, {\n                    top: instance.style.top,\n                    left: instance.style.left,\n                    width: instance.style.width,\n                    height: instance.offsetHeight + 'px'\n                });\n            });\n        });\n    });\n};\n\n/**\n * Reset handle when drag ends\n */\nconst dragendHandler = () => {\n    document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n        cover.style.display = 'none';\n    });\n};\n\n/**\n * Prepare to drag divider\n *\n * @param {event} e mouse event\n */\nconst dragstartHandler = (e) => {\n    if (e.target.classList.contains('videotimetab-resize-handle')) {\n        column = e.target.closest('.tab-pane').querySelector('.videotimetab-resize');\n        e.stopPropagation();\n        e.preventDefault();\n        document.querySelectorAll('.videotime-tab-instance-cover').forEach((cover) => {\n            cover.style.display = 'block';\n        });\n    }\n};\n\n/**\n * Resize the content and player to mouse location\n *\n * @param {event} e mouse event\n */\nconst mousemoveHandler = (e) => {\n    document.querySelectorAll('.videotimetab-resize-handle').forEach((h) => {\n        if (h.closest('.tab-pane') && document.querySelector('.videotime-tab-instance-cover').style.display == 'block') {\n            column.style.width = e.pageX - column.getBoundingClientRect().left + 'px';\n        }\n    });\n};\n\n/**\n * Move video to new time when link clicked\n *\n * @param {event} e mouse event\n */\nconst cueVideo = (e) => {\n    if (e.target.matches('[data-action=\"cue\"]')) {\n        let starttime = e.target.closest('a').getAttribute('data-start'),\n            time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+))/),\n            iframe = e.target.closest('.videotimetabs').querySelector('.vimeo-embed iframe'),\n            player = new Player(iframe);\n        e.preventDefault();\n        e.stopPropagation();\n        if (time) {\n            player.setCurrentTime(\n                3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6])\n            ).then(player.play.bind(player)\n            ).catch(Notification.exception);\n        }\n    }\n};\n"],"file":"resize_tab_player.min.js"}