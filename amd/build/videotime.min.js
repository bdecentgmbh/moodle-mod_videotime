define(["jquery","mod_videotime/player","core/ajax","core/log"],function(a,b,c,d){return{init:function(a,e,f,g,h,i,j){d.debug("VIDEO_TIME embed options",g);var k=new b("vimeo-embed-"+h,g);if(f){var l=!1,m=0,n=0,o=0;i>0&&k.on("loaded",function(){k.setCurrentTime(i)}),k.on("play",function(){l=!0,d.debug("VIDEO_TIME play")}),k.on("playing",function(){l=!0,d.debug("VIDEO_TIME playing")}),k.on("pause",function(){l=!1,d.debug("VIDEO_TIME pause")}),k.on("stalled",function(){l=!1,d.debug("VIDEO_TIME stalled")}),k.on("suspend",function(){l=!1,d.debug("VIDEO_TIME suspend")}),k.on("abort",function(){l=!1,d.debug("VIDEO_TIME abort")}),k.on("ended",function(){l=!1,d.debug("VIDEO_TIME ended"),c.call([{methodname:"videotimeplugin_pro_set_session_state",args:{session_id:a.id,state:1}}])[0].done(function(){c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:a.id,percent:1}}])[0].done(function(){j&&(window.location.href=j)})})}),k.on("timeupdate",function(a){n=a.percent,o=a.seconds,d.debug("VIDEO_TIME timeupdate. Percent: "+n+". Current time: "+o)}),setInterval(function(){l&&(m++,m%e===0&&(d.debug("VIDEO_TIME watch_time: "+m+". percent: "+n),c.call([{methodname:"videotimeplugin_pro_record_watch_time",args:{session_id:a.id,time:m}}]),c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:a.id,percent:n}}]),c.call([{methodname:"videotimeplugin_pro_set_session_current_time",args:{session_id:a.id,current_time:o}}])))},1e3)}}}});