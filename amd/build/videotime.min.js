define(["jquery","mod_videotime/player","core/ajax","core/log"],function(a,b,c,d){return{init:function(a,e,f,g,h,i){d.debug("VIDEO_TIME embed options",g);var j=new b("vimeo-embed-"+h,g);if(f){var k=!1,l=0,m=0,n=0;i>0&&j.on("loaded",function(){j.setCurrentTime(i)}),j.on("play",function(){k=!0,d.debug("VIDEO_TIME play")}),j.on("playing",function(){k=!0,d.debug("VIDEO_TIME playing")}),j.on("pause",function(){k=!1,d.debug("VIDEO_TIME pause")}),j.on("stalled",function(){k=!1,d.debug("VIDEO_TIME stalled")}),j.on("suspend",function(){k=!1,d.debug("VIDEO_TIME suspend")}),j.on("abort",function(){k=!1,d.debug("VIDEO_TIME abort")}),j.on("ended",function(){k=!1,d.debug("VIDEO_TIME ended"),c.call([{methodname:"videotimeplugin_pro_set_session_state",args:{session_id:a.id,state:1}}]),c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:a.id,percent:1}}])}),j.on("timeupdate",function(a){m=a.percent,n=a.seconds,d.debug("VIDEO_TIME timeupdate. Percent: "+m+". Current time: "+n)}),setInterval(function(){k&&(l++,l%e===0&&(d.debug("VIDEO_TIME watch_time: "+l+". percent: "+m),c.call([{methodname:"videotimeplugin_pro_record_watch_time",args:{session_id:a.id,time:l}}]),c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:a.id,percent:m}}]),c.call([{methodname:"videotimeplugin_pro_set_session_current_time",args:{session_id:a.id,current_time:n}}])))},1e3)}}}});