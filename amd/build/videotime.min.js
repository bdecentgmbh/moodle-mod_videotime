define(["jquery","mod_videotime/player","core/ajax","core/log"],function(a,b,c,d){return{init:function(a,e,f,g){d.debug("VIDEO_TIME embed options",g);var h=new b("vimeo-embed",g);if(f){var i=!1,j=0,k=0;h.on("play",function(){i=!0,d.debug("VIDEO_TIME play")}),h.on("playing",function(){i=!0,d.debug("VIDEO_TIME playing")}),h.on("pause",function(){i=!1,d.debug("VIDEO_TIME pause")}),h.on("stalled",function(){i=!1,d.debug("VIDEO_TIME stalled")}),h.on("suspend",function(){i=!1,d.debug("VIDEO_TIME suspend")}),h.on("abort",function(){i=!1,d.debug("VIDEO_TIME abort")}),h.on("ended",function(){i=!1,d.debug("VIDEO_TIME ended"),c.call([{methodname:"videotimeplugin_pro_set_session_state",args:{session_id:a.id,state:1}}]),c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:a.id,percent:1}}])}),h.on("timeupdate",function(a){i=!0,k=a.percent,d.debug("VIDEO_TIME timeupdate")}),setInterval(function(){i&&(j++,j%e===0&&(d.debug("VIDEO_TIME watch_time: "+j+". percent: "+k),c.call([{methodname:"videotimeplugin_pro_record_watch_time",args:{session_id:a.id,time:j}}]),c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:a.id,percent:k}}])))},1e3)}}}});