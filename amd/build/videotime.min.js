define(["jquery","mod_videotime/player","core/ajax","core/log"],function(a,b,c,d){return{init:function(a,e,f,g,h){d.debug("VIDEO_TIME embed options",g);var i=new b("vimeo-embed-"+h,g);if(f){var j=!1,k=0,l=0;i.on("play",function(){j=!0,d.debug("VIDEO_TIME play")}),i.on("playing",function(){j=!0,d.debug("VIDEO_TIME playing")}),i.on("pause",function(){j=!1,d.debug("VIDEO_TIME pause")}),i.on("stalled",function(){j=!1,d.debug("VIDEO_TIME stalled")}),i.on("suspend",function(){j=!1,d.debug("VIDEO_TIME suspend")}),i.on("abort",function(){j=!1,d.debug("VIDEO_TIME abort")}),i.on("ended",function(){j=!1,d.debug("VIDEO_TIME ended"),c.call([{methodname:"videotimeplugin_pro_set_session_state",args:{session_id:a.id,state:1}}]),c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:a.id,percent:1}}])}),i.on("timeupdate",function(a){l=a.percent,d.debug("VIDEO_TIME timeupdate")}),setInterval(function(){j&&(k++,k%e===0&&(d.debug("VIDEO_TIME watch_time: "+k+". percent: "+l),c.call([{methodname:"videotimeplugin_pro_record_watch_time",args:{session_id:a.id,time:k}}]),c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:a.id,percent:l}}])))},1e3)}}}});