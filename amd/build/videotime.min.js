define ("mod_videotime/videotime",["jquery","mod_videotime/player","core/ajax","core/log","core/templates"],function(a,b,c,d,e){return{init:function init(f,g,h,i,j,k,l){d.debug("VIDEO_TIME embed options",i);if(0==a("#vimeo-embed-"+j).length){d.debug("Vimeo video element not found: #vimeo-embed-"+j);return}var m=new b("vimeo-embed-"+j,i);if(h){var n=!1,o=0,p=0,q=0;if(0<k){m.on("loaded",function(){m.setCurrentTime(k)})}m.on("play",function(){n=!0;d.debug("VIDEO_TIME play")});m.on("playing",function(){n=!0;d.debug("VIDEO_TIME playing")});m.on("pause",function(){n=!1;d.debug("VIDEO_TIME pause")});m.on("stalled",function(){n=!1;d.debug("VIDEO_TIME stalled")});m.on("suspend",function(){n=!1;d.debug("VIDEO_TIME suspend")});m.on("abort",function(){n=!1;d.debug("VIDEO_TIME abort")});m.on("ended",function(){n=!1;d.debug("VIDEO_TIME ended");c.call([{methodname:"videotimeplugin_pro_set_session_state",args:{session_id:f.id,state:1}}])[0].done(function(){c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:f.id,percent:1}}])[0].done(function(){c.call([{methodname:"videotimeplugin_pro_set_session_current_time",args:{session_id:f.id,current_time:q}}])[0].done(function(){if(l){window.location.href=l}else{c.call([{methodname:"videotimeplugin_pro_get_next_activity_button_data",args:{session_id:f.id}}])[0].done(function(b){e.render("videotime/next_activity_button",JSON.parse(b.data)).then(function(b){a("#next-activity-button").html(b)})})}})})})});m.on("timeupdate",function(a){p=a.percent;q=a.seconds;d.debug("VIDEO_TIME timeupdate. Percent: "+p+". Current time: "+q)});setInterval(function(){if(n){o++;if(0==o%g){d.debug("VIDEO_TIME watch_time: "+o+". percent: "+p);c.call([{methodname:"videotimeplugin_pro_record_watch_time",args:{session_id:f.id,time:o}}]);c.call([{methodname:"videotimeplugin_pro_set_percent",args:{session_id:f.id,percent:p}}]);c.call([{methodname:"videotimeplugin_pro_set_session_current_time",args:{session_id:f.id,current_time:q}}])}}},1e3)}}}});
//# sourceMappingURL=videotime.min.js.map
