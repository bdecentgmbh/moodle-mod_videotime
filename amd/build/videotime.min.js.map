{"version":3,"sources":["../src/videotime.js"],"names":["define","$","Vimeo","Ajax","Log","Templates","VideoTime","elementId","cmId","hasPro","interval","player","resumeTime","session","played","playing","time","percent","currentTime","prototype","initialize","debug","getResumeTime","getEmbedOptions","then","response","JSON","parse","options","addListeners","bind","this","on","getSession","view","seconds","setCurrentTime","event","Promise","resolve","setSessionState","id","setPercent","catch","error","alert","finally","getNextActivityButtonData","data","instance","next_activity_auto","is_restricted","hasnextcm","window","location","href","nextcm_url","render","html","startWatchInterval","setInterval","recordWatchTime","sessionId","state","call","methodname","args","session_id","current_time","cmid"],"mappings":"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","sourcesContent":["/*\r\n * @package    mod_videotime\r\n * @copyright  2018 bdecent gmbh <https://bdecent.de>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * @module mod_videotime/videotime\r\n */\r\ndefine(['jquery', 'mod_videotime/player', 'core/ajax', 'core/log', 'core/templates'], function($, Vimeo, Ajax, Log, Templates) {\r\n\r\n    let VideoTime = function(elementId, cmId, hasPro, interval) {\r\n        this.elementId = elementId;\r\n        this.cmId = cmId;\r\n        this.hasPro = hasPro;\r\n        this.interval = interval;\r\n        this.player = null;\r\n        this.resumeTime = null;\r\n        this.session = null;\r\n\r\n        this.played = false;\r\n\r\n        this.playing = false;\r\n        this.time = 0;\r\n        this.percent = 0;\r\n        this.currentTime = 0;\r\n    };\r\n\r\n    VideoTime.prototype.initialize = async function() {\r\n        Log.debug('Initializing Video Time ' + this.elementId);\r\n\r\n        if (this.hasPro) {\r\n            this.resumeTime = await this.getResumeTime(this.cmId);\r\n        }\r\n\r\n        this.getEmbedOptions().then(function(response) {\r\n            Log.debug('Initializing Vimeo player with options:');\r\n            Log.debug(response);\r\n            this.player = new Vimeo(this.elementId, JSON.parse(response.options));\r\n            this.addListeners();\r\n        }.bind(this));\r\n    };\r\n\r\n    /**\r\n     * Register player events to respond to user interaction and play progress.\r\n     */\r\n    VideoTime.prototype.addListeners = function() {\r\n        if (!this.player) {\r\n            Log.debug('Player was not properly initialized for course module ' . this.cmId);\r\n        }\r\n\r\n        // Fire view event in Moodle on first play only.\r\n        this.player.on('play', function () {\r\n            if (!this.played) {\r\n                // Getting a new session on first play.\r\n                this.getSession().then(function() {\r\n                    this.view();\r\n                }.bind(this));\r\n            }\r\n        }.bind(this));\r\n\r\n        // Features beyond this point are for pro only.\r\n        if (!this.hasPro) {\r\n            return;\r\n        }\r\n\r\n        // If resume is present force seek the player to that point.\r\n        if (this.resumeTime && this.resumeTime.seconds > 0) {\r\n            this.player.on('loaded', function() {\r\n                this.player.setCurrentTime(this.resumeTime.seconds);\r\n            }.bind(this));\r\n        }\r\n\r\n        // Note: Vimeo player does not support multiple events in a single on() call. Each requires it's own function.\r\n\r\n        // Catch all events where video plays.\r\n        this.player.on('play', function (e) {\r\n            this.playing = true;\r\n            Log.debug('VIDEO_TIME play');\r\n        }.bind(this));\r\n        this.player.on('playing', function () {\r\n            this.playing = true;\r\n            Log.debug('VIDEO_TIME playing');\r\n        }.bind(this));\r\n\r\n        // Catch all events where video stops.\r\n        this.player.on('pause', function () {\r\n            this.playing = false;\r\n            Log.debug('VIDEO_TIME pause');\r\n        }.bind(this));\r\n        this.player.on('stalled', function () {\r\n            this.playing = false;\r\n            Log.debug('VIDEO_TIME stalled');\r\n        }.bind(this));\r\n        this.player.on('suspend', function () {\r\n            this.playing = false;\r\n            Log.debug('VIDEO_TIME suspend');\r\n        }.bind(this));\r\n        this.player.on('abort', function () {\r\n            this.playing = false;\r\n            Log.debug('VIDEO_TIME abort');\r\n        }.bind(this));\r\n\r\n        // Always update internal values for percent and current time watched.\r\n        this.player.on('timeupdate', function(event) {\r\n            this.percent = event.percent;\r\n            this.currentTime = event.seconds;\r\n            Log.debug('VIDEO_TIME timeupdate. Percent: ' + this.percent + '. Current time: ' + this.currentTime);\r\n        }.bind(this));\r\n\r\n        // Initiate video finish procedure.\r\n        this.player.on('ended', function () {\r\n            this.playing = false;\r\n            Log.debug('VIDEO_TIME ended');\r\n\r\n            new Promise(function(resolve, reject) {\r\n                this.getSession().then(function(session) {\r\n                    resolve(session);\r\n                });\r\n            }.bind(this)).then(function(session) {\r\n                this.setSessionState(session.id, 1);\r\n                return session;\r\n            }.bind(this)).then(function(session) {\r\n                this.setPercent(session.id, 1);\r\n                return session;\r\n            }.bind(this)).then(function(session) {\r\n                this.setCurrentTime(session.id, this.currentTime);\r\n                return session;\r\n            }.bind(this)).catch(function(error) {\r\n                alert(error);\r\n            }).finally(function(session) {\r\n                this.getSession().then(function(session) {\r\n                    this.getNextActivityButtonData(session.id).then(function(response) {\r\n                        let data = JSON.parse(response.data);\r\n\r\n                        if (data.instance.next_activity_auto) {\r\n                            if (!data.is_restricted && data.hasnextcm) {\r\n                                window.location.href = data.nextcm_url;\r\n                            }\r\n                        }\r\n\r\n                        Templates.render('videotime/next_activity_button', JSON.parse(response.data))\r\n                            .then(function (html, js) {\r\n                                $('#next-activity-button').html(html);\r\n                            });\r\n                    }.bind(this));\r\n                }.bind(this));\r\n            }.bind(this));\r\n        }.bind(this));\r\n\r\n        this.startWatchInterval();\r\n    };\r\n\r\n    /**\r\n     * Start interval that will periodically record user progress via Ajax.\r\n     */\r\n    VideoTime.prototype.startWatchInterval = function() {\r\n        setInterval(function () {\r\n            if (this.playing) {\r\n                this.time++;\r\n\r\n                this.getSession().then(function(session) {\r\n                    if (this.time % this.interval === 0) {\r\n                        Log.debug('VIDEO_TIME watch_time: ' + this.time + '. percent: ' + this.percent);\r\n                        this.recordWatchTime(session.id, this.time);\r\n                        this.setPercent(session.id, this.percent);\r\n                        this.setCurrentTime(session.id, this.currentTime);\r\n                    }\r\n                }.bind(this));\r\n            }\r\n        }.bind(this), 1000);\r\n    };\r\n\r\n    /**\r\n     * Set state on session.\r\n     *\r\n     * @param sessionId\r\n     * @param state\r\n     * @returns {Promise}\r\n     */\r\n    VideoTime.prototype.setSessionState = function(sessionId, state) {\r\n        return Ajax.call([{\r\n            methodname: 'videotimeplugin_pro_set_session_state',\r\n            args: {session_id: sessionId, state: state}\r\n        }])[0];\r\n    };\r\n\r\n    /**\r\n     * Set current watch time for video. Used for resuming.\r\n     *\r\n     * @param {int} sessionId\r\n     * @param {float} currentTime\r\n     * @returns {Promise}\r\n     */\r\n    VideoTime.prototype.setCurrentTime = function(sessionId, currentTime) {\r\n        return Ajax.call([{\r\n            methodname: 'videotimeplugin_pro_set_session_current_time',\r\n            args: {session_id: sessionId, current_time: currentTime}\r\n        }])[0];\r\n    };\r\n\r\n    /**\r\n     * Set video watch percentage for session.\r\n     *\r\n     * @param {int} sessionId\r\n     * @param {float} percent\r\n     * @returns {Promise}\r\n     */\r\n    VideoTime.prototype.setPercent = function(sessionId, percent) {\r\n        return Ajax.call([{\r\n            methodname: 'videotimeplugin_pro_set_percent',\r\n            args: {session_id: sessionId, percent: percent}\r\n        }])[0];\r\n    };\r\n\r\n    /**\r\n     * Record watch time for session.\r\n     *\r\n     * @param {int} sessionId\r\n     * @param {float} time\r\n     * @returns {Promise}\r\n     */\r\n    VideoTime.prototype.recordWatchTime = function(sessionId, time) {\r\n        return Ajax.call([{\r\n            methodname: 'videotimeplugin_pro_record_watch_time',\r\n            args: {session_id: sessionId, time: time}\r\n        }])[0];\r\n    };\r\n\r\n    /**\r\n     * Get data for next activity button.\r\n     *\r\n     * @param {int} sessionId\r\n     * @returns {Promise}\r\n     */\r\n    VideoTime.prototype.getNextActivityButtonData = function(sessionId) {\r\n        return Ajax.call([{\r\n            methodname: 'videotimeplugin_pro_get_next_activity_button_data',\r\n            args: { session_id: sessionId }\r\n        }])[0];\r\n    };\r\n\r\n    /**\r\n     * Get embed options for this course module.\r\n     *\r\n     * @returns {Promise}\r\n     */\r\n    VideoTime.prototype.getEmbedOptions = function() {\r\n        return Ajax.call([{\r\n            methodname: 'mod_videotime_get_embed_options',\r\n            args: { cmid: this.cmId }\r\n        }])[0];\r\n    };\r\n\r\n    /**\r\n     * Get time to resume video as seconds.\r\n     *\r\n     * @returns {Promise}\r\n     */\r\n    VideoTime.prototype.getResumeTime = function(cmId) {\r\n        return Ajax.call([{\r\n            methodname: 'videotimeplugin_pro_get_resume_time',\r\n            args: { cmid: cmId }\r\n        }])[0];\r\n    };\r\n\r\n    /**\r\n     * Get new or existing video viewing session.\r\n     *\r\n     * @returns {Promise}\r\n     */\r\n    VideoTime.prototype.getSession = function() {\r\n        if (this.session) {\r\n            return Promise.resolve(this.session);\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            Ajax.call([{\r\n                methodname: 'videotimeplugin_pro_get_new_session',\r\n                args: { cmid: this.cmId }\r\n            }])[0].then(function(response) {\r\n                this.session = response;\r\n                resolve(response);\r\n            }.bind(this));\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Log the user view of video.\r\n     *\r\n     * @returns {Promise}\r\n     */\r\n    VideoTime.prototype.view = function() {\r\n        return Ajax.call([{\r\n            methodname: 'mod_videotime_view_videotime',\r\n            args: { cmid: this.cmId }\r\n        }])[0];\r\n    };\r\n\r\n    return VideoTime;\r\n});\r\n"],"file":"videotime.min.js"}