<<<<<<< HEAD
{"version":3,"sources":["../src/videotime.js"],"names":["define","$","Vimeo","Ajax","Config","Log","Templates","Notification","VideoTime","elementId","cmId","hasPro","interval","instance","player","resumeTime","session","played","playing","time","percent","currentTime","playbackRate","plugins","hasClass","addClass","document","on","initializeNewInstances","bind","modulecount","length","prototype","getCmId","registerPlugin","plugin","push","initialize","debug","autopause","autoplay","background","byline","color","controls","dnt","height","loop","option_loop","maxheight","maxwidth","muted","portrait","pip","playsinline","responsive","speed","title","transparent","url","vimeo_url","width","URL","window","location","href","q","searchParams","get","starttime","match","setStartTime","then","find","catch","exception","handleStartTime","addListeners","i","getCurrentTime","getPaused","getPlayer","closest","each","tabs","index","anchor","getAttribute","addCuePoint","exeception","event","data","removeClass","offsetTop","parentNode","scrollTo","top","left","behavior","startWatchInterval","view","resume_playback","resume_time","getDuration","duration","Math","floor","setCurrentPosition","fail","getPlaybackRate","seconds","forEach","setCurrentTime","getSessions","id","handleEnd","handlePause","getSession","setSessionState","setPercent","getNextActivityButtonData","response","JSON","parse","parseInt","next_activity_auto","is_restricted","hasnextcm","link","nextcm_url","first","click","render","html","watchInterval","setInterval","paused","recordWatchTime","sessionId","state","token","wwwroot","set","fetch","ok","exeption","json","call","methodname","args","Promise","resolve","getInstance","cmid","done","getResumeTime","module","attr","replace","haspro","uniqueid","js","runTemplateJS","secs","getCurrentPosition"],"mappings":"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","sourcesContent":["/*\n * @package    mod_videotime\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_videotime/videotime\n */\ndefine([\n    'jquery',\n    'mod_videotime/player',\n    'core/ajax',\n    'core/config',\n    'core/log',\n    'core/templates',\n    'core/notification'\n], function($, Vimeo, Ajax, Config, Log, Templates, Notification) {\n    var VideoTime = function(elementId, cmId, hasPro, interval, instance) {\n        this.elementId = elementId;\n        this.cmId = cmId;\n        this.hasPro = hasPro;\n        this.interval = interval;\n        this.player = null;\n        this.resumeTime = null;\n        this.session = null;\n        this.instance = instance;\n\n        this.played = false;\n\n        this.playing = false;\n        this.time = 0;\n        this.percent = 0;\n        this.currentTime = 0;\n        this.playbackRate = 1;\n\n        this.plugins = [];\n\n        if (hasPro && $('body').hasClass('path-course-view') && !$('body').hasClass('vtinit')) {\n            $('body').addClass('vtinit');\n            $(document).on('focus', 'body', this.initializeNewInstances.bind(this));\n        }\n        this.modulecount = $('body .activity.videotime').length;\n    };\n\n    /**\n     * Get course module ID of this VideoTime instance.\n     *\n     * @return {int}\n     */\n    VideoTime.prototype.getCmId = function() {\n        return this.cmId;\n    };\n\n    /**\n     * Register a plugin to hook into VideoTime functionality.\n     *\n     * @param {VideoTimePlugin} plugin\n     */\n    VideoTime.prototype.registerPlugin = function(plugin) {\n        this.plugins.push(plugin);\n    };\n\n    VideoTime.prototype.initialize = function() {\n        let instance = this.instance;\n        Log.debug('Initializing Video Time ' + this.elementId);\n\n        Log.debug('Initializing Vimeo player with options:');\n        Log.debug(instance);\n        this.player = new Vimeo(this.elementId, {\n            autopause: Number(instance.autopause),\n            autoplay: Number(instance.autoplay),\n            background: Number(instance.background),\n            byline: Number(instance.byline),\n            color: instance.color,\n            controls: Number(instance.controls),\n            dnt: Number(instance.dnt),\n            height: instance.height,\n            loop: Number(instance.option_loop),\n            maxheight: instance.maxheight,\n            maxwidth: instance.maxwidth,\n            muted: Number(instance.muted),\n            portrait: instance.portrait,\n            pip: Number(instance.pip),\n            playsinline: instance.playsinline,\n            responsive: Number(instance.responsive),\n            speed: instance.speed,\n            title: Number(instance.title),\n            transparent: Number(instance.transparent),\n            url: instance.vimeo_url,\n            width: instance.width\n        });\n\n        let url = new URL(window.location.href),\n            q = url.searchParams.get('q'),\n            starttime = (url.searchParams.get('time') || '').match(/^([0-9]+:){0,2}([0-9]+)(\\.[0-9]+)$/);\n        if (starttime) {\n            this.setStartTime(starttime[0]).then(function() {\n                if (q && window.find) {\n                    window.find(q);\n                }\n                return true;\n            }).catch(Notification.exception);\n        } else if (q && window.find) {\n            window.find(q);\n        }\n\n        this.handleStartTime();\n\n        this.addListeners();\n\n        for (let i = 0; i < this.plugins.length; i++) {\n            const plugin = this.plugins[i];\n            plugin.initialize(this, instance);\n        }\n\n        return true;\n    };\n\n    VideoTime.prototype.handleStartTime = function() {\n        const url = new URL(window.location.href),\n            q = url.searchParams.get('q'),\n            starttime = (url.searchParams.get('time') || '').match(/^([0-9]+:){0,2}([0-9]+)(\\.[0-9]+)$/);\n        if (q && window.find) {\n            window.find(q);\n        }\n        if (starttime) {\n            return this.setStartTime(starttime[0]);\n        }\n        return this.player.getCurrentTime();\n    };\n\n    /**\n     * Get pause state\n     *\n     * @return {Promise}\n     */\n    VideoTime.prototype.getPaused = function() {\n        return this.player.getPaused();\n    };\n\n    /**\n     * Get Vimeo player object.\n     *\n     * @returns {Vimeo}\n     */\n    VideoTime.prototype.getPlayer = function() {\n        return this.player;\n    };\n\n    /**\n     * Register player events to respond to user interaction and play progress.\n     */\n    VideoTime.prototype.addListeners = function() {\n        if (!this.player) {\n            Log.debug('Player was not properly initialized for course module ' + this.cmId);\n            return;\n        }\n\n        // If this is a tab play set time cues and listener.\n        $($('#' + this.elementId).closest('.videotimetabs')).each(function(i, tabs) {\n           $(tabs).find('[data-action=\"cue\"]').each(function(index, anchor) {\n                let starttime = anchor.getAttribute('data-start'),\n                    time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+))/);\n                if (time) {\n                    this.player.addCuePoint(\n                        3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]),\n                        {\n                            starttime: starttime\n                        }\n                    ).catch(Notification.exeception);\n                }\n            }.bind(this));\n\n            this.player.on('cuepoint', function(event) {\n                if (event.data.starttime) {\n                    $(tabs).find('.videotime-highlight').removeClass('videotime-highlight');\n                    $(tabs).find('[data-action=\"cue\"][data-start=\"' + event.data.starttime + '\"]')\n                        .closest('.row')\n                        .addClass('videotime-highlight');\n                    $('.videotime-highlight').each(function() {\n                        if (this.offsetTop) {\n                            this.parentNode.scrollTo({\n                                top: this.offsetTop - 50,\n                                left: 0,\n                                behavior: 'smooth'\n                            });\n                        }\n                    });\n                }\n            });\n        }.bind(this));\n\n        // Fire view event in Moodle on first play only.\n        this.player.on('play', () => {\n            if (this.hasPro) {\n                this.startWatchInterval();\n            }\n            this.view();\n            return true;\n        });\n\n        // Features beyond this point are for pro only.\n        if (!this.hasPro) {\n            return;\n        }\n\n        // If resume is present force seek the player to that point.\n        this.player.on(\"loaded\", () => {\n            if (!this.instance.resume_playback || !this.instance.resume_time || this.instance.resume_time <= 0) {\n                return true;\n            }\n\n            return this.getDuration().then((duration) => {\n                let resumeTime = this.instance.resume_time;\n                // Duration is often a little greater than a resume time at the end of the video.\n                // A user may have watched 100 seconds when the video ends, but the duration may be\n                // 100.56 seconds. BUT, sometimes the duration is rounded depending on when the\n                // video loads, so it may be 101 seconds. Hence the +1 and Math.floor usage.\n                if (resumeTime + 1 >= Math.floor(duration)) {\n                    Log.debug(\n                        \"VIDEO_TIME video finished, resuming at start of video.\"\n                    );\n                    resumeTime = 0;\n                }\n                Log.debug(\"VIDEO_TIME duration is \" + duration);\n                Log.debug(\"VIDEO_TIME resuming at \" + resumeTime);\n                this.setCurrentPosition(resumeTime);\n                return true;\n            }).fail(Notification.exception);\n        });\n\n        // Note: Vimeo player does not support multiple events in a single on() call. Each requires it's own function.\n\n        // Catch all events where video plays.\n        this.player.on('play', function() {\n            this.playing = true;\n            Log.debug('VIDEO_TIME play');\n        }.bind(this));\n        this.player.on('playing', function() {\n            this.playing = true;\n            Log.debug('VIDEO_TIME playing');\n        }.bind(this));\n\n        // Catch all events where video stops.\n        this.player.on('pause', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME pause');\n        }.bind(this));\n        this.player.on('stalled', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME stalled');\n        }.bind(this));\n        this.player.on('suspend', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME suspend');\n        }.bind(this));\n        this.player.on('abort', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME abort');\n        }.bind(this));\n\n        this.player.getPlaybackRate().then(function(playbackRate) {\n            this.playbackRate = playbackRate;\n        }.bind(this)).catch(Notification.exception);\n\n        this.player.on('playbackratechange', function(event) {\n            this.playbackRate = event.playbackRate;\n        }.bind(this));\n\n        // Always update internal values for percent and current time watched.\n        this.player.on('timeupdate', function(event) {\n            this.percent = event.percent;\n            this.currentTime = event.seconds;\n            if (event.seconds === event.duration) {\n                this.plugins.forEach(plugin => {\n                    if (typeof plugin.setCurrentTime == 'function') {\n                        plugin.getSessions().then(session => {\n                            plugin.setCurrentTime(session.id, event.seconds);\n                            return session;\n                        }).catch(Notification.exception);\n                    }\n                });\n            }\n        }.bind(this));\n\n        // Initiate video finish procedure.\n        this.player.on('ended', this.handleEnd.bind(this));\n        this.player.on('pause', this.handlePause.bind(this));\n    };\n\n    /**\n     * Handle pause\n     */\n    VideoTime.prototype.handlePause = function() {\n        this.plugins.forEach(plugin => {\n            if (typeof plugin.handlePause == 'function') {\n                plugin.handlePause();\n            }\n        });\n    };\n\n    /**\n     * Start interval that will periodically record user progress via Ajax.\n     */\n    VideoTime.prototype.handleEnd = function() {\n        this.playing = false;\n        Log.debug('VIDEO_TIME ended');\n        if (this.plugins.length > 2) {\n            this.plugins.forEach(plugin => {\n                if (typeof plugin.handleEnd == 'function') {\n                    plugin.handleEnd();\n                }\n            });\n        } else {\n            // This moved to pro plugin, but left for compatibility.\n            this.getSession().then(function(session) {\n                this.setSessionState(session.id, 1).then(() => {\n                    return this.setPercent(session.id, 1);\n                }).then(() => {\n                    return this.setCurrentTime(session.id, this.currentTime);\n                }).then(() => {\n                    return this.getNextActivityButtonData(session.id).then(response => {\n                        let data = JSON.parse(response.data);\n\n                        if (data.instance && parseInt(data.instance.next_activity_auto)) {\n                            if (!data.is_restricted && data.hasnextcm) {\n                                let link = $('.aalink[href=\"' + data.nextcm_url + '\"] img').first();\n                                if ($('.path-course-view').length && link) {\n                                    link.click();\n                                } else {\n                                    window.location.href = data.nextcm_url;\n                                }\n                            }\n                        }\n\n                        return Templates.render('videotime/next_activity_button', JSON.parse(response.data))\n                            .then(function(html) {\n                                $('#next-activity-button').html(html);\n                                return true;\n                            });\n                    });\n                }).catch(Notification.exception);\n            }.bind(this)).catch(Notification.exception);\n        }\n    };\n\n    /**\n     * Start interval that will periodically record user progress via Ajax.\n     */\n    VideoTime.prototype.startWatchInterval = function() {\n        this.plugins.forEach(plugin => {\n            if (typeof plugin.startWatchInterval == 'function') {\n                this.watchInterval = true;\n                plugin.startWatchInterval();\n            }\n        });\n        if (this.watchInterval) {\n            return;\n        }\n\n        this.watchInterval = setInterval(function() {\n            this.getPaused().then(paused => {\n                if (!paused) {\n                    this.time += this.playbackRate;\n                }\n            });\n        }.bind(this), 1000);\n\n        this.watchInterval = setInterval(function() {\n            this.getSession().then(session => {\n                Log.debug('VIDEO_TIME watch_time: ' + this.time + '. percent: ' + this.percent);\n                this.recordWatchTime(session.id, this.time);\n                this.setPercent(session.id, this.percent);\n                this.setCurrentTime(session.id, this.currentTime);\n            }).catch(Notification.exception);\n        }.bind(this), this.interval);\n    };\n\n    /**\n     * Set state on session.\n     *\n     * @param {int} sessionId\n     * @param {int} state\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setSessionState = function(sessionId, state) {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'videotimeplugin_pro_set_session_state');\n            data.set('state', state);\n            data.set('session_id', sessionId);\n            return fetch(url).then((response) => {\n                if (!response.ok) {\n                    Notification.exeption('Web service error');\n                }\n                return response.json();\n            });\n        }\n\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_set_session_state',\n            args: {\"session_id\": sessionId, state: state},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Set current watch time for video. Used for resuming.\n     *\n     * @param {int} sessionId\n     * @param {float} currentTime\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setCurrentTime = function(sessionId, currentTime) {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'videotimeplugin_pro_set_session_current_time');\n            data.set('current_time', currentTime);\n            data.set('session_id', sessionId);\n            return fetch(url).then((response) => {\n                if (!response.ok) {\n                    Notification.exeption('Web service error');\n                }\n                return response.json();\n            });\n        }\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_set_session_current_time',\n            args: {\"session_id\": sessionId, \"current_time\": currentTime},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Set video watch percentage for session.\n     *\n     * @param {int} sessionId\n     * @param {float} percent\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setPercent = function(sessionId, percent) {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'videotimeplugin_pro_set_percent');\n            data.set('percent', percent);\n            data.set('session_id', sessionId);\n            return fetch(url).then((response) => {\n                if (!response.ok) {\n                    Notification.exeption('Web service error');\n                }\n                return response.json();\n            });\n        }\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_set_percent',\n            args: {\"session_id\": sessionId, percent: percent},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Record watch time for session.\n     *\n     * @param {int} sessionId\n     * @param {float} time\n     * @returns {Promise}\n     */\n    VideoTime.prototype.recordWatchTime = function(sessionId, time) {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'videotimeplugin_pro_record_watch_time');\n            data.set('session_id', sessionId);\n            data.set('time', time);\n            return fetch(url).then((response) => {\n                if (!response.ok) {\n                    Notification.exeption('Web service error');\n                }\n                return response.json();\n            });\n        }\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_record_watch_time',\n            args: {\"session_id\": sessionId, time: time},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Get data for next activity button.\n     *\n     * @param {int} sessionId\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getNextActivityButtonData = function(sessionId) {\n        if (this.instance.token) {\n            // We do not support button in iframe.\n            return Promise.resolve({data: '{}'});\n        }\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_get_next_activity_button_data',\n            args: {\"session_id\": sessionId}\n        }])[0];\n    };\n\n    /**\n     * Get VideoTime instance for this course module.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getInstance = function() {\n        if (this.instance) {\n            return Promise.resolve(this.instance);\n        }\n\n        return Ajax.call([{\n            methodname: 'mod_videotime_get_videotime',\n            args: {cmid: this.cmId},\n            done: (response) => {\n                this.instance = response;\n                return this.instance;\n            },\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Get time to resume video as seconds.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getResumeTime = function() {\n        if (this.resumeTime) {\n            return Promise.resolve(this.resumeTime);\n        }\n\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_get_resume_time',\n            args: {cmid: this.cmId},\n            done: (response) => {\n                this.resumeTime = response.seconds;\n                return this.resumeTime;\n            },\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Get new or existing video viewing session.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getSession = function() {\n        if (this.instance.token) {\n            if (!this.session) {\n                const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                    data = url.searchParams;\n                data.set('wstoken', this.instance.token);\n                data.set('moodlewsrestformat', 'json');\n                data.set('wsfunction', 'videotimeplugin_pro_get_new_session');\n                data.set('cmid', this.cmId);\n                this.session = fetch(url).then((response) => {\n                    if (!response.ok) {\n                        Notification.exeption('Web service error');\n                    }\n                    return response.json();\n                });\n            }\n\n            return this.session;\n        }\n        if (!this.session) {\n            this.session = Ajax.call([{\n                methodname: 'videotimeplugin_pro_get_new_session',\n                args: {cmid: this.cmId},\n                fail: Notification.exception\n            }])[0];\n        }\n        return this.session;\n    };\n\n    /**\n     * Parse start time and set player\n     *\n     * @param {string} starttime\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setStartTime = function(starttime) {\n        let time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+))/);\n        if (time) {\n            this.resumeTime = 3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]);\n            this.currentTime(this.resumeTime);\n        }\n        return this.player.getCurrentTime();\n    };\n\n    /**\n     * Log the user view of video.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.view = function() {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'mod_videotime_view_videotime');\n            data.set('cmid', this.cmId);\n            return fetch(url).then((response) => {\n                if (!response.ok) {\n                    Notification.exeption('Web service error');\n                }\n                return response.json();\n            });\n\n        }\n        return Ajax.call([{\n            methodname: 'mod_videotime_view_videotime',\n            args: {cmid: this.cmId},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Initialize new labels and preview when editing\n     */\n    VideoTime.prototype.initializeNewInstances = function() {\n        if (this.modulecount == $('body .activity.videotime').length) {\n            return;\n        }\n        this.modulecount = $('body .activity.videotime').length;\n        $('body .activity.videotime').each(function(index, module) {\n            if (\n                !$(module).find('.instancename').length\n                && $(module).find('.vimeo-embed').length\n                && !$(module).find('.vimeo-embed iframe').length\n            ) {\n                let instance = {\n                    cmid: Number($(module).attr('id').replace('module-', '')),\n                    haspro: true,\n                    interval: this.interval,\n                    uniqueid: $(module).find('.vimeo-embed').first().attr('id').replace('vimeo-embed-', '')\n                };\n                Templates.render('mod_videotime/videotime_instance', {\n                    instance: instance\n                }).then(function(html, js) {\n                    Templates.runTemplateJS(js);\n                    return true;\n                }).fail(Notification.exception);\n            }\n        }.bind(this));\n    };\n\n    /**\n     * Get play back rate\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getPlaybackRate = function() {\n        return this.player.getPlaybackRate();\n    };\n\n    /**\n     * Get duration of video\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getDuration = function() {\n        return this.player.getDuration();\n    };\n\n    /**\n     * Set current time of player\n     *\n     * @param {float} secs time\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setCurrentPosition = function(secs) {\n        return this.player.setCurrentTime(secs);\n    };\n\n    /**\n     * Get current time of player\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getCurrentPosition = function() {\n        return this.player.getCurrentTime();\n    };\n\n    return VideoTime;\n});\n"],"file":"videotime.min.js"}
=======
{"version":3,"file":"videotime.min.js","sources":["../src/videotime.js"],"sourcesContent":["/*\n * @package    mod_videotime\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_videotime/videotime\n */\ndefine([\n    'jquery',\n    'mod_videotime/player',\n    'core/ajax',\n    'core/config',\n    'core/log',\n    'core/templates',\n    'core/notification'\n], function($, Vimeo, Ajax, Config, Log, Templates, Notification) {\n    let VideoTime = function(elementId, cmId, hasPro, interval, instance) {\n        this.elementId = elementId;\n        this.cmId = cmId;\n        this.hasPro = hasPro;\n        this.interval = interval;\n        this.player = null;\n        this.resumeTime = null;\n        this.session = null;\n        this.instance = instance;\n\n        this.played = false;\n\n        this.playing = false;\n        this.time = 0;\n        this.percent = 0;\n        this.currentTime = 0;\n        this.playbackRate = 1;\n\n        this.plugins = [];\n\n        if (hasPro && $('body').hasClass('path-course-view') && !$('body').hasClass('vtinit')) {\n            $('body').addClass('vtinit');\n        }\n        this.modulecount = $('body .activity.videotime').length;\n    };\n\n    /**\n     * Get course module ID of this VideoTime instance.\n     *\n     * @return {int}\n     */\n    VideoTime.prototype.getCmId = function() {\n        return this.cmId;\n    };\n\n    /**\n     * Register a plugin to hook into VideoTime functionality.\n     *\n     * @param {VideoTimePlugin} plugin\n     */\n    VideoTime.prototype.registerPlugin = function(plugin) {\n        this.plugins.push(plugin);\n    };\n\n    VideoTime.prototype.initialize = function() {\n        let instance = this.instance;\n        Log.debug('Initializing Video Time ' + this.elementId);\n\n        Log.debug('Initializing Vimeo player with options:');\n        Log.debug(instance);\n        this.player = new Vimeo(this.elementId, {\n            autopause: Number(instance.autopause),\n            autoplay: Number(instance.autoplay),\n            background: Number(instance.background),\n            byline: Number(instance.byline),\n            color: instance.color,\n            controls: Number(instance.controls),\n            dnt: Number(instance.dnt),\n            height: instance.height,\n            loop: Number(instance.option_loop),\n            maxheight: instance.maxheight,\n            maxwidth: instance.maxwidth,\n            muted: Number(instance.muted),\n            portrait: instance.portrait,\n            pip: Number(instance.pip),\n            playsinline: instance.playsinline,\n            responsive: Number(instance.responsive),\n            speed: instance.speed,\n            title: Number(instance.title),\n            transparent: Number(instance.transparent),\n            url: instance.vimeo_url,\n            width: instance.width\n        });\n\n        this.handleStartTime();\n\n        this.addListeners();\n\n        for (let i = 0; i < this.plugins.length; i++) {\n            const plugin = this.plugins[i];\n            plugin.initialize(this, instance);\n        }\n\n        return true;\n    };\n\n    VideoTime.prototype.handleStartTime = async function() {\n        const url = new URL(window.location.href),\n            q = url.searchParams.get('q'),\n            starttime = (url.searchParams.get('time') || '').match(/^([0-9]+:){0,2}([0-9]+)(\\.[0-9]+)$/);\n        if (starttime) {\n            await this.setStartTime(starttime[0]);\n        }\n        if (q && window.find) {\n            window.find(q);\n        }\n    };\n\n    /**\n     * Get pause state\n     *\n     * @return {bool}\n     */\n    VideoTime.prototype.getPaused = async function() {\n        return await this.player.getPaused();\n    };\n\n    /**\n     * Get Vimeo player object.\n     *\n     * @returns {Vimeo}\n     */\n    VideoTime.prototype.getPlayer = function() {\n        return this.player;\n    };\n\n    /**\n     * Register player events to respond to user interaction and play progress.\n     */\n    VideoTime.prototype.addListeners = async function() {\n        if (!this.player) {\n            Log.debug('Player was not properly initialized for course module ' + this.cmId);\n            return;\n        }\n\n        // If this is a tab play set time cues and listener.\n        $($('#' + this.elementId).closest('.videotimetabs')).each(function(i, tabs) {\n           $(tabs).find('[data-action=\"cue\"]').each(async function(index, anchor) {\n                let starttime = anchor.getAttribute('data-start'),\n                    time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+))/);\n                if (time) {\n                    await this.player.addCuePoint(\n                        3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]),\n                        {\n                            starttime: starttime\n                        }\n                    );\n                }\n            }.bind(this));\n\n            this.player.on('cuepoint', function(event) {\n                if (event.data.starttime) {\n                    $(tabs).find('.videotime-highlight').removeClass('videotime-highlight');\n                    $(tabs).find('[data-action=\"cue\"][data-start=\"' + event.data.starttime + '\"]')\n                        .closest('.row')\n                        .addClass('videotime-highlight');\n                    $('.videotime-highlight').each(function() {\n                        if (this.offsetTop) {\n                            this.parentNode.scrollTo({\n                                top: this.offsetTop - 50,\n                                left: 0,\n                                behavior: 'smooth'\n                            });\n                        }\n                    });\n                }\n            });\n        }.bind(this));\n\n        // Fire view event in Moodle on first play only.\n        this.player.on('play', () => {\n            if (this.hasPro) {\n                this.startWatchInterval();\n            }\n            this.view();\n            return true;\n        });\n\n        // Features beyond this point are for pro only.\n        if (!this.hasPro) {\n            return;\n        }\n\n        // If resume is present force seek the player to that point.\n        this.player.on(\"loaded\", () => {\n            if (!this.instance.resume_playback || !this.instance.resume_time || this.instance.resume_time <= 0) {\n                return;\n            }\n\n            this.resume();\n        });\n\n        // Note: Vimeo player does not support multiple events in a single on() call. Each requires it's own function.\n\n        // Catch all events where video plays.\n        this.player.on('play', function() {\n            this.playing = true;\n            Log.debug('VIDEO_TIME play');\n        }.bind(this));\n        this.player.on('playing', function() {\n            this.playing = true;\n            Log.debug('VIDEO_TIME playing');\n        }.bind(this));\n\n        // Catch all events where video stops.\n        this.player.on('pause', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME pause');\n        }.bind(this));\n        this.player.on('stalled', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME stalled');\n        }.bind(this));\n        this.player.on('suspend', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME suspend');\n        }.bind(this));\n        this.player.on('abort', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME abort');\n        }.bind(this));\n\n        this.playbackRate = await this.player.getPlaybackRate();\n\n        this.player.on('playbackratechange', function(event) {\n            this.playbackRate = event.playbackRate;\n        }.bind(this));\n\n        // Always update internal values for percent and current time watched.\n        this.player.on('timeupdate', function(event) {\n            setTimeout(async() => {\n                var preventUpdate = false;\n                if (event.seconds === event.duration) {\n                    this.plugins.forEach(async(plugin) => {\n                        if (typeof plugin.setCurrentTime == 'function') {\n                            const session = plugin.getSession();\n                            plugin.setCurrentTime(session.id, event.seconds);\n                        }\n                    });\n                }\n                if (Number(this.instance.preventfastforwarding)) {\n                    const playbackRate = await this.getPlaybackRate();\n                    this.plugins.forEach((plugin) => {\n                        if (\n                                (typeof plugin.watchTime != 'undefined')\n                                && (event.seconds > plugin.watchTime + plugin.fastForwardBuffer * playbackRate)\n                        ) {\n                            preventUpdate = true;\n                        }\n                    });\n                }\n                if (preventUpdate) {\n                    return;\n                }\n                this.percent = event.percent;\n                this.currentTime = event.seconds;\n            }, 100);\n        }.bind(this));\n\n        // Initiate video finish procedure.\n        this.player.on('ended', this.handleEnd.bind(this));\n        this.player.on('pause', this.handlePause.bind(this));\n    };\n\n    VideoTime.prototype.resume = async function() {\n        const duration = await this.getDuration();\n        let resumeTime = this.instance.resume_time;\n        // Duration is often a little greater than a resume time at the end of the video.\n        // A user may have watched 100 seconds when the video ends, but the duration may be\n        // 100.56 seconds. BUT, sometimes the duration is rounded depending on when the\n        // video loads, so it may be 101 seconds. Hence the +1 and Math.floor usage.\n        if (resumeTime + 1 >= Math.floor(duration)) {\n            Log.debug(\n                \"VIDEO_TIME video finished, resuming at start of video.\"\n            );\n            resumeTime = 0;\n        }\n        Log.debug(\"VIDEO_TIME duration is \" + duration);\n        Log.debug(\"VIDEO_TIME resuming at \" + resumeTime);\n        await this.setCurrentPosition(resumeTime);\n        return true;\n    };\n\n    /**\n     * Handle pause\n     */\n    VideoTime.prototype.handlePause = function() {\n        this.plugins.forEach(plugin => {\n            if (typeof plugin.handlePause == 'function') {\n                plugin.handlePause();\n            }\n        });\n    };\n\n    /**\n     * Start interval that will periodically record user progress via Ajax.\n     */\n    VideoTime.prototype.handleEnd = async function() {\n        this.playing = false;\n        Log.debug('VIDEO_TIME ended');\n        if (this.plugins.length > 2) {\n            this.plugins.forEach(plugin => {\n                if (typeof plugin.handleEnd == 'function') {\n                    plugin.handleEnd();\n                }\n            });\n        } else {\n            // This moved to pro plugin, but left for compatibility.\n            const session = await this.getSession();\n            await this.setSessionState(session.id, 1);\n            await this.setPercent(session.id, 1);\n            await this.setCurrentTime(session.id, this.currentTime);\n            const response = await this.getNextActivityButtonData(session.id);\n            const data = JSON.parse(response.data);\n            if (data.instance && parseInt(data.instance.next_activity_auto)) {\n                if (!data.is_restricted && data.hasnextcm) {\n                    let link = $('.aalink[href=\"' + data.nextcm_url + '\"] img').first();\n                    if ($('.path-course-view').length && link) {\n                        link.click();\n                    } else {\n                        window.location.href = data.nextcm_url;\n                    }\n                }\n            }\n\n            const html = await Templates.render('videotime/next_activity_button', JSON.parse(response.data));\n            $('#next-activity-button').html(html);\n        }\n    };\n\n    /**\n     * Start interval that will periodically record user progress via Ajax.\n     */\n    VideoTime.prototype.startWatchInterval = function() {\n        this.plugins.forEach(plugin => {\n            if (typeof plugin.startWatchInterval == 'function') {\n                this.watchInterval = true;\n                plugin.startWatchInterval();\n            }\n        });\n        if (this.watchInterval) {\n            return;\n        }\n\n        this.watchInterval = setInterval(async function() {\n            if (!this.getPaused()) {\n                this.time += this.playbackRate;\n            }\n        }.bind(this), 1000);\n\n        this.watchInterval = setInterval(async function() {\n            const session = await this.getSession();\n            Log.debug('VIDEO_TIME watch_time: ' + this.time + '. percent: ' + this.percent);\n            this.recordWatchTime(session.id, this.time);\n            this.setPercent(session.id, this.percent);\n            this.setCurrentTime(session.id, this.currentTime);\n        }.bind(this), this.interval);\n    };\n\n    /**\n     * Set state on session.\n     *\n     * @param {int} sessionId\n     * @param {int} state\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setSessionState = async function(sessionId, state) {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'videotimeplugin_pro_set_session_state');\n            data.set('state', state);\n            data.set('session_id', sessionId);\n            const response = await fetch(url);\n            if (!response.ok) {\n                Notification.exeption('Web service error');\n            }\n            return await response.json();\n        }\n\n        return await Ajax.call([{\n            methodname: 'videotimeplugin_pro_set_session_state',\n            args: {\"session_id\": sessionId, state: state},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Set current watch time for video. Used for resuming.\n     *\n     * @param {int} sessionId\n     * @param {float} currentTime\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setCurrentTime = async function(sessionId, currentTime) {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'videotimeplugin_pro_set_session_current_time');\n            data.set('current_time', currentTime);\n            data.set('session_id', sessionId);\n            const response = await fetch(url);\n            if (!response.ok) {\n                Notification.exeption('Web service error');\n            }\n            return await response.json();\n        }\n        return await Ajax.call([{\n            methodname: 'videotimeplugin_pro_set_session_current_time',\n            args: {\"session_id\": sessionId, \"current_time\": currentTime},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Set video watch percentage for session.\n     *\n     * @param {int} sessionId\n     * @param {float} percent\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setPercent = async function(sessionId, percent) {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'videotimeplugin_pro_set_percent');\n            data.set('percent', percent);\n            data.set('session_id', sessionId);\n            const response = await fetch(url);\n            if (!response.ok) {\n                Notification.exeption('Web service error');\n            }\n            return await response.json();\n        }\n        return await Ajax.call([{\n            methodname: 'videotimeplugin_pro_set_percent',\n            args: {\"session_id\": sessionId, percent: percent},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Record watch time for session.\n     *\n     * @param {int} sessionId\n     * @param {float} time\n     * @returns {Promise}\n     */\n    VideoTime.prototype.recordWatchTime = async function(sessionId, time) {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'videotimeplugin_pro_record_watch_time');\n            data.set('session_id', sessionId);\n            data.set('time', time);\n            const response = await fetch(url);\n            if (!response.ok) {\n                Notification.exeption('Web service error');\n            }\n            return await response.json();\n        }\n        return await Ajax.call([{\n            methodname: 'videotimeplugin_pro_record_watch_time',\n            args: {\"session_id\": sessionId, time: time},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Get data for next activity button.\n     *\n     * @param {int} sessionId\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getNextActivityButtonData = async function(sessionId) {\n        if (this.instance.token) {\n            // We do not support button in iframe.\n            return {data: '{}'};\n        }\n        return await Ajax.call([{\n            methodname: 'videotimeplugin_pro_get_next_activity_button_data',\n            args: {\"session_id\": sessionId}\n        }])[0];\n    };\n\n    /**\n     * Get VideoTime instance for this course module.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getInstance = async function() {\n        if (this.instance) {\n            return this.instance;\n        }\n\n        return await Ajax.call([{\n            methodname: 'mod_videotime_get_videotime',\n            args: {cmid: this.cmId},\n            done: (response) => {\n                this.instance = response;\n                return this.instance;\n            },\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Get time to resume video as seconds.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getResumeTime = async function() {\n        if (this.resumeTime) {\n            return this.resumeTime;\n        }\n\n        return await Ajax.call([{\n            methodname: 'videotimeplugin_pro_get_resume_time',\n            args: {cmid: this.cmId},\n            done: (response) => {\n                this.resumeTime = response.seconds;\n                return this.resumeTime;\n            },\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Get new or existing video viewing session.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getSession = async function() {\n        if (this.instance.token) {\n            if (!this.session) {\n                const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                    data = url.searchParams;\n                data.set('wstoken', this.instance.token);\n                data.set('moodlewsrestformat', 'json');\n                data.set('wsfunction', 'videotimeplugin_pro_get_new_session');\n                data.set('cmid', this.cmId);\n                this.session = await fetch(url);\n                if (!this.session.ok) {\n                    Notification.exeption('Web service error');\n                }\n                return await this.session.json();\n            }\n\n            return await this.session;\n        }\n        if (!this.session) {\n            this.session = Ajax.call([{\n                methodname: 'videotimeplugin_pro_get_new_session',\n                args: {cmid: this.cmId},\n                fail: Notification.exception\n            }])[0];\n        }\n        return await this.session;\n    };\n\n    /**\n     * Parse start time and set player\n     *\n     * @param {string} starttime\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setStartTime = async function(starttime) {\n        const time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+))/);\n        if (time) {\n            this.resumeTime = 3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]);\n            this.currentTime(this.resumeTime);\n        }\n        return await this.player.getCurrentTime();\n    };\n\n    /**\n     * Log the user view of video.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.view = async function() {\n        if (this.instance.token) {\n            const url = new URL(Config.wwwroot + '/webservice/rest/server.php'),\n                data = url.searchParams;\n            data.set('wstoken', this.instance.token);\n            data.set('moodlewsrestformat', 'json');\n            data.set('wsfunction', 'mod_videotime_view_videotime');\n            data.set('cmid', this.cmId);\n            const response = await fetch(url);\n            if (!response.ok) {\n                Notification.exeption('Web service error');\n            }\n            return await response.json();\n        }\n        return await Ajax.call([{\n            methodname: 'mod_videotime_view_videotime',\n            args: {cmid: this.cmId},\n            fail: Notification.exception\n        }])[0];\n    };\n\n    /**\n     * Get play back rate\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getPlaybackRate = async function() {\n        return await this.player.getPlaybackRate();\n    };\n\n    /**\n     * Get duration of video\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getDuration = async function() {\n        return await this.player.getDuration();\n    };\n\n    /**\n     * Set current time of player\n     *\n     * @param {float} secs time\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setCurrentPosition = async function(secs) {\n        return await this.player.setCurrentTime(secs);\n    };\n\n    /**\n     * Get current time of player\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getCurrentPosition = async function() {\n        return await this.player.getCurrentTime();\n    };\n\n    return VideoTime;\n});\n"],"names":["define","$","Vimeo","Ajax","Config","Log","Templates","Notification","VideoTime","elementId","cmId","hasPro","interval","instance","player","resumeTime","session","played","playing","time","percent","currentTime","playbackRate","plugins","hasClass","addClass","modulecount","length","prototype","getCmId","this","registerPlugin","plugin","push","initialize","debug","autopause","Number","autoplay","background","byline","color","controls","dnt","height","loop","option_loop","maxheight","maxwidth","muted","portrait","pip","playsinline","responsive","speed","title","transparent","url","vimeo_url","width","handleStartTime","addListeners","i","async","URL","window","location","href","q","searchParams","get","starttime","match","setStartTime","find","getPaused","getPlayer","closest","each","tabs","index","anchor","getAttribute","addCuePoint","bind","on","event","data","removeClass","offsetTop","parentNode","scrollTo","top","left","behavior","startWatchInterval","view","resume_playback","resume_time","resume","getPlaybackRate","setTimeout","preventUpdate","seconds","duration","forEach","setCurrentTime","getSession","id","preventfastforwarding","watchTime","fastForwardBuffer","handleEnd","handlePause","getDuration","Math","floor","setCurrentPosition","setSessionState","setPercent","response","getNextActivityButtonData","JSON","parse","parseInt","next_activity_auto","is_restricted","hasnextcm","link","nextcm_url","first","click","html","render","watchInterval","setInterval","recordWatchTime","sessionId","state","token","wwwroot","set","fetch","ok","exeption","json","call","methodname","args","fail","exception","getInstance","cmid","done","getResumeTime","getCurrentTime","secs","getCurrentPosition"],"mappings":"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"}
>>>>>>> 6189f76... VID-811: Save time before seek
