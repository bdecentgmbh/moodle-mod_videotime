{"version":3,"file":"videotime.min.js","sources":["../src/videotime.js"],"sourcesContent":["/*\n * @package    mod_videotime\n * @copyright  2021 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_videotime/videotime\n */\ndefine([\n    'jquery',\n    'mod_videotime/player',\n    'core/ajax',\n    'core/log',\n    'core/templates',\n    'core/notification'\n], function(\n    $,\n    Vimeo,\n    Ajax,\n    Log,\n    Templates,\n    Notification\n) {\n\n    let VideoTime = function(elementId, cmId, hasPro, interval) {\n        this.elementId = elementId;\n        this.cmId = cmId;\n        this.hasPro = hasPro;\n        this.interval = interval;\n        this.player = null;\n        this.resumeTime = null;\n        this.session = null;\n        this.instance = null;\n\n        this.played = false;\n\n        this.playing = false;\n        this.time = 0;\n        this.percent = 0;\n        this.currentTime = 0;\n        this.playbackRate = 1;\n\n        this.plugins = [];\n\n        if (hasPro && $('body').hasClass('path-course-view') && !$('body').hasClass('vtinit')) {\n            $('body').addClass('vtinit');\n            $(document).on('focus', 'body', this.initializeNewInstances.bind(this));\n        }\n        this.modulecount = $('body .activity.videotime').length;\n    };\n\n    /**\n     * Get course module ID of this VideoTime instance.\n     *\n     * @return {int}\n     */\n    VideoTime.prototype.getCmId = function() {\n        return this.cmId;\n    };\n\n    /**\n     * Register a plugin to hook into VideoTime functionality.\n     *\n     * @param {VideoTimePlugin} plugin\n     */\n    VideoTime.prototype.registerPlugin = function(plugin) {\n        this.plugins.push(plugin);\n    };\n\n    VideoTime.prototype.initialize = function() {\n        Log.debug('Initializing Video Time ' + this.elementId);\n\n        this.getInstance().then((instance) => {\n            Log.debug('Initializing Vimeo player with options:');\n            Log.debug(instance);\n            this.player = new Vimeo(this.elementId, {\n                autopause: instance.autopause,\n                autoplay: instance.autoplay,\n                background: instance.background,\n                byline: instance.byline,\n                color: instance.color,\n                controls: instance.controls,\n                dnt: instance.dnt,\n                height: instance.height,\n                loop: instance.option_loop,\n                maxheight: instance.maxheight,\n                maxwidth: instance.maxwidth,\n                muted: instance.muted,\n                portrait: instance.portrait,\n                pip: instance.pip,\n                playsinline: instance.playsinline,\n                responsive: instance.responsive,\n                speed: instance.speed,\n                title: instance.title,\n                transparent: instance.transparent,\n                url: instance.vimeo_url,\n                width: instance.width\n            });\n\n            let url = new URL(window.location.href),\n                q = url.searchParams.get('q'),\n                starttime = (url.searchParams.get('time') || '').match(/^([0-9]+:){0,2}([0-9]+)(\\.[0-9]+)$/);\n            if (starttime) {\n                this.setStartTime(starttime[0]).then(function() {\n                    if (q && window.find) {\n                        window.find(q);\n                    }\n                    return true;\n                }).catch(Notification.exception);\n            } else if (q && window.find) {\n                window.find(q);\n            }\n\n            this.addListeners();\n\n            for (let i = 0; i < this.plugins.length; i++) {\n                const plugin = this.plugins[i];\n                plugin.initialize(this, instance);\n            }\n\n            return true;\n        }).catch(Notification.exeption);\n    };\n\n    /**\n     * Get Vimeo player object.\n     *\n     * @returns {Vimeo}\n     */\n    VideoTime.prototype.getPlayer = function() {\n        return this.player;\n    };\n\n    /**\n     * Register player events to respond to user interaction and play progress.\n     */\n    VideoTime.prototype.addListeners = function() {\n        if (!this.player) {\n            Log.debug('Player was not properly initialized for course module ' + this.cmId);\n            return;\n        }\n\n        // Fire view event in Moodle on first play only.\n        this.player.on('play', () => {\n            if (!this.played) {\n                if (this.hasPro) {\n                    // Getting a new session on first play.\n                    this.getSession().then(() => {\n                        this.view();\n                        this.startWatchInterval();\n                        return true;\n                    }).catch(Notification.exception);\n                } else {\n                    // Free version can still mark completion on video time view.\n                    this.view();\n                }\n            }\n            return true;\n        });\n\n        // Features beyond this point are for pro only.\n        if (!this.hasPro) {\n            return;\n        }\n\n        // If resume is present force seek the player to that point.\n        this.getResumeTime().then((seconds) => {\n            if (seconds <= 0) {\n                return true;\n            }\n\n            this.getDuration().then((duration) => {\n                let resumeTime = seconds;\n                // Duration is often a little greater than a resume time at the end of the video.\n                // A user may have watched 100 seconds when the video ends, but the duration may be\n                // 100.56 seconds. BUT, sometimes the duration is rounded depending on when the\n                // video loads, so it may be 101 seconds. Hence the +1 and Math.floor usage.\n                if (seconds + 1 >= Math.floor(duration)) {\n                    Log.debug('VIDEO_TIME video finished, resuming at start of video.');\n                    resumeTime = 0;\n                }\n\n                Log.debug('VIDEO_TIME resuming at ' + resumeTime);\n                this.setCurrentPosition(this.resumeTime);\n\n                return true;\n            }).catch(Notification.exception);\n\n            return true;\n        }).catch(Notification.exception);\n\n        // Note: Vimeo player does not support multiple events in a single on() call. Each requires it's own function.\n\n        // Catch all events where video plays.\n        this.player.on('play', function() {\n            this.playing = true;\n            Log.debug('VIDEO_TIME play');\n        }.bind(this));\n        this.player.on('playing', function() {\n            this.playing = true;\n            Log.debug('VIDEO_TIME playing');\n        }.bind(this));\n\n        // Catch all events where video stops.\n        this.player.on('pause', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME pause');\n        }.bind(this));\n        this.player.on('stalled', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME stalled');\n        }.bind(this));\n        this.player.on('suspend', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME suspend');\n        }.bind(this));\n        this.player.on('abort', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME abort');\n        }.bind(this));\n\n        this.player.getPlaybackRate().then(function(playbackRate) {\n            this.playbackRate = playbackRate;\n        }.bind(this)).catch(Notification.exception);\n\n        this.player.on('playbackratechange', function(event) {\n            this.playbackRate = event.playbackRate;\n        }.bind(this));\n\n        // Always update internal values for percent and current time watched.\n        this.player.on('timeupdate', function(event) {\n            this.percent = event.percent;\n            this.currentTime = event.seconds;\n            Log.debug('VIDEO_TIME timeupdate. Percent: ' + this.percent + '. Current time: ' + this.currentTime);\n        }.bind(this));\n\n        // Initiate video finish procedure.\n        this.player.on('ended', function() {\n            this.playing = false;\n            Log.debug('VIDEO_TIME ended');\n\n            new Promise(function(resolve) {\n                this.getSession().then(function(session) {\n                    resolve(session);\n                    return true;\n                }).catch(Notification.exception);\n            }.bind(this)).then(function(session) {\n                this.setSessionState(session.id, 1);\n                return session;\n            }.bind(this)).then(function(session) {\n                this.setPercent(session.id, 1);\n                return session;\n            }.bind(this)).then(function(session) {\n                this.setCurrentTime(session.id, this.currentTime);\n                return session;\n            }.bind(this)).catch(Notification.exception).finally(function() {\n                this.getSession().then(function(session) {\n                    this.getNextActivityButtonData(session.id).then(function(response) {\n                        let data = JSON.parse(response.data);\n\n                        if (data.instance && parseInt(data.instance.next_activity_auto)) {\n                            if (!data.is_restricted && data.hasnextcm) {\n                                let link = $('.aalink[href=\"' + data.nextcm_url + '\"] img').first();\n                                if ($('.path-course-view').length && link) {\n                                    link.click();\n                                } else {\n                                    window.location.href = data.nextcm_url;\n                                }\n                            }\n                        }\n\n                        Templates.render('videotime/next_activity_button', JSON.parse(response.data))\n                            .then(function(html) {\n                                $('#next-activity-button').html(html);\n                                return true;\n                            }).fail(Notification.exception);\n                        return true;\n                    }).fail(Notification.exception);\n                }.bind(this)).catch(Notification.exception);\n            }.bind(this)).fail(Notification.exception);\n        }.bind(this));\n\n        // If this is a tab play set time cues and listener.\n        $($('#' + this.elementId).closest('.videotimetabs')).each(function(i, tabs) {\n           $(tabs).find('[data-action=\"cue\"]').each(function(index, anchor) {\n                let starttime = anchor.getAttribute('data-start'),\n                    time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+))/);\n                if (time) {\n                    this.player.addCuePoint(\n                        3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]),\n                        {\n                            starttime: starttime\n                        }\n                    ).catch(Notification.exeception);\n                }\n            }.bind(this));\n\n            this.player.on('cuepoint', function(event) {\n                if (event.data.starttime) {\n                    $(tabs).find('.videotime-highlight').removeClass('videotime-highlight');\n                    $(tabs).find('[data-action=\"cue\"][data-start=\"' + event.data.starttime + '\"]')\n                        .closest('.row')\n                        .addClass('videotime-highlight');\n                    $('.videotime-highlight').each(function() {\n                        if (this.offsetTop) {\n                            this.parentNode.scrollTo({\n                                top: this.offsetTop - 50,\n                                left: 0,\n                                behavior: 'smooth'\n                            });\n                        }\n                    });\n                }\n            });\n        }.bind(this));\n    };\n\n    /**\n     * Start interval that will periodically record user progress via Ajax.\n     */\n    VideoTime.prototype.startWatchInterval = function() {\n        if (this.watchInterval) {\n            return;\n        }\n\n        this.watchInterval = setInterval(function() {\n            if (this.playing) {\n                this.time += this.playbackRate;\n\n                this.getSession().then(function(session) {\n                    if (this.time % this.interval === 0) {\n                        Log.debug('VIDEO_TIME watch_time: ' + this.time + '. percent: ' + this.percent);\n                        this.recordWatchTime(session.id, this.time);\n                        this.setPercent(session.id, this.percent);\n                        this.setCurrentTime(session.id, this.currentTime);\n                    }\n                    return true;\n                }.bind(this)).catch(Notification.exception);\n            }\n        }.bind(this), 1000);\n    };\n\n    /**\n     * Set state on session.\n     *\n     * @param {int} sessionId\n     * @param {int} state\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setSessionState = function(sessionId, state) {\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_set_session_state',\n            args: {\"session_id\": sessionId, state: state}\n        }])[0];\n    };\n\n    /**\n     * Set current watch time for video. Used for resuming.\n     *\n     * @param {int} sessionId\n     * @param {float} currentTime\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setCurrentTime = function(sessionId, currentTime) {\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_set_session_current_time',\n            args: {\"session_id\": sessionId, \"current_time\": currentTime}\n        }])[0];\n    };\n\n    /**\n     * Set video watch percentage for session.\n     *\n     * @param {int} sessionId\n     * @param {float} percent\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setPercent = function(sessionId, percent) {\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_set_percent',\n            args: {\"session_id\": sessionId, percent: percent}\n        }])[0];\n    };\n\n    /**\n     * Record watch time for session.\n     *\n     * @param {int} sessionId\n     * @param {float} time\n     * @returns {Promise}\n     */\n    VideoTime.prototype.recordWatchTime = function(sessionId, time) {\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_record_watch_time',\n            args: {\"session_id\": sessionId, time: time}\n        }])[0];\n    };\n\n    /**\n     * Get data for next activity button.\n     *\n     * @param {int} sessionId\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getNextActivityButtonData = function(sessionId) {\n        return Ajax.call([{\n            methodname: 'videotimeplugin_pro_get_next_activity_button_data',\n            args: {\"session_id\": sessionId}\n        }])[0];\n    };\n\n    /**\n     * Get VideoTime instance for this course module.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getInstance = function() {\n        if (this.instance) {\n            return Promise.resolve(this.instance);\n        }\n\n        return new Promise((resolve) => {\n            Ajax.call([{\n                methodname: 'mod_videotime_get_videotime',\n                args: {cmid: this.cmId}\n            }])[0].then((response) => {\n                this.instance = response;\n                resolve(this.instance);\n                return true;\n            }).fail(Notification.exception);\n        });\n    };\n\n    /**\n     * Get time to resume video as seconds.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getResumeTime = function() {\n        if (this.resumeTime) {\n            return Promise.resolve(this.resumeTime);\n        }\n\n        return new Promise((resolve) => {\n            Ajax.call([{\n                methodname: 'videotimeplugin_pro_get_resume_time',\n                args: {cmid: this.cmId}\n            }])[0].then((response) => {\n                this.resumeTime = response.seconds;\n                resolve(this.resumeTime);\n                return true;\n            }).fail(Notification.exception);\n        });\n    };\n\n    /**\n     * Get new or existing video viewing session.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getSession = function() {\n        if (this.session) {\n            return Promise.resolve(this.session);\n        }\n\n        return new Promise((resolve) => {\n            Ajax.call([{\n                methodname: 'videotimeplugin_pro_get_new_session',\n                args: {cmid: this.cmId}\n            }])[0].then(function(response) {\n                this.session = response;\n                resolve(response);\n                return true;\n            }.bind(this)).fail(Notification.exception);\n        });\n    };\n\n    /**\n     * Parse start time and set player\n     *\n     * @param {string} starttime\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setStartTime = function(starttime) {\n        let time = starttime.match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\\.[0-9]+))/);\n        if (time) {\n            this.resumeTime = 3600 * Number(time[3] || 0) + 60 * Number(time[5] || 0) + Number(time[6]);\n            this.currentTime(this.resumeTime);\n        }\n        return this.player.getCurrentTime();\n    };\n\n    /**\n     * Log the user view of video.\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.view = function() {\n        return Ajax.call([{\n            methodname: 'mod_videotime_view_videotime',\n            args: {cmid: this.cmId}\n        }])[0];\n    };\n\n    /**\n     * Initialize new labels and preview when editing\n     */\n    VideoTime.prototype.initializeNewInstances = function() {\n        if (this.modulecount == $('body .activity.videotime').length) {\n            return;\n        }\n        this.modulecount = $('body .activity.videotime').length;\n        $('body .activity.videotime').each(function(index, module) {\n            if (\n                !$(module).find('.instancename').length\n                && $(module).find('.vimeo-embed').length\n                && !$(module).find('.vimeo-embed iframe').length\n            ) {\n                let instance = {\n                    cmid: Number($(module).attr('id').replace('module-', '')),\n                    haspro: true,\n                    interval: this.interval,\n                    uniqueid: $(module).find('.vimeo-embed').first().attr('id').replace('vimeo-embed-', '')\n                };\n                Templates.render('mod_videotime/videotime_instance', {\n                    instance: instance\n                }).then(function(html, js) {\n                    Templates.runTemplateJS(js);\n                    return true;\n                }).fail(Notification.exception);\n            }\n        }.bind(this));\n    };\n\n    /**\n     * Get play back rate\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getPlaybackRate = function() {\n        return this.player.getPlaybackRate();\n    };\n\n    /**\n     * Get duration of video\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getDuration = function() {\n        return this.player.getDuration();\n    };\n\n    /**\n     * Set current time of player\n     *\n     * @param {float} secs time\n     * @returns {Promise}\n     */\n    VideoTime.prototype.setCurrentPosition = function(secs) {\n        return this.player.setCurrentTime(secs);\n    };\n\n    /**\n     * Get current time of player\n     *\n     * @returns {Promise}\n     */\n    VideoTime.prototype.getCurrentPosition = function() {\n        return this.player.getCurrentTime();\n    };\n\n    return VideoTime;\n});\n"],"names":["define","$","Vimeo","Ajax","Log","Templates","Notification","VideoTime","elementId","cmId","hasPro","interval","player","resumeTime","session","instance","played","playing","time","percent","currentTime","playbackRate","plugins","hasClass","addClass","document","on","this","initializeNewInstances","bind","modulecount","length","prototype","getCmId","registerPlugin","plugin","push","initialize","debug","getInstance","then","_this","autopause","autoplay","background","byline","color","controls","dnt","height","loop","option_loop","maxheight","maxwidth","muted","portrait","pip","playsinline","responsive","speed","title","transparent","url","vimeo_url","width","URL","window","location","href","q","searchParams","get","starttime","match","setStartTime","find","catch","exception","addListeners","i","exeption","getPlayer","_this2","getSession","view","startWatchInterval","getResumeTime","seconds","getDuration","duration","Math","floor","setCurrentPosition","getPlaybackRate","event","Promise","resolve","setSessionState","id","setPercent","setCurrentTime","finally","getNextActivityButtonData","response","data","JSON","parse","parseInt","next_activity_auto","is_restricted","hasnextcm","link","nextcm_url","first","click","render","html","fail","closest","each","tabs","index","anchor","getAttribute","addCuePoint","Number","exeception","removeClass","offsetTop","parentNode","scrollTo","top","left","behavior","watchInterval","setInterval","recordWatchTime","sessionId","state","call","methodname","args","cmid","_this3","_this4","_this5","getCurrentTime","module","attr","replace","haspro","uniqueid","js","runTemplateJS","secs","getCurrentPosition"],"mappings":"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"}