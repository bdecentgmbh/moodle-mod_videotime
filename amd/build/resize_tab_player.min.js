/*
 * Position the Vimeo player within tab layout
 *
 * @package    mod_videotime
 * @module     mod_videotime/resize_tab_player
 * @copyright  2021 bdecent gmbh <https://bdecent.de>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_videotime/resize_tab_player",["mod_videotime/player","core/notification"],(function(Player,Notification){var resizeTabPlayer=function(){this.initialize()};return resizeTabPlayer.prototype.column="",resizeTabPlayer.prototype.initialize=function(){let observer=new ResizeObserver(this.resize);new MutationObserver(this.resize).observe(document.querySelector("#page-content"),{subtree:!0,childList:!0}),document.querySelectorAll(".instance-container, div.videotime-tab-instance").forEach((container=>{observer.observe(container)})),this.resize(),document.querySelectorAll(".videotime-tab-instance").forEach((instance=>{instance.style.position="absolute"})),window.removeEventListener("mousemove",this.mousemoveHandler),window.addEventListener("mousemove",this.mousemoveHandler),window.removeEventListener("dragstart",this.dragstartHandler),window.addEventListener("dragstart",this.dragstartHandler),window.removeEventListener("mouseup",this.dragendHandler),window.addEventListener("mouseup",this.dragendHandler),window.removeEventListener("click",this.cueVideo),window.addEventListener("click",this.cueVideo)},resizeTabPlayer.prototype.resize=function(){document.querySelectorAll(".instance-container").forEach((container=>{container.offsetWidth&&container.closest(".videotimetabs").querySelectorAll(".videotime-tab-instance .vimeo-embed iframe").forEach((iframe=>{let instance=iframe.closest(".videotime-tab-instance"),content=iframe.closest(".tab-content");Object.assign(instance.style,{top:container.offsetTop+"px",left:container.offsetLeft+"px",width:container.offsetWidth+"px"}),container.style.minHeight=iframe.closest(".videotime-tab-instance").offsetHeight+"px",content.querySelectorAll(".videotime-tab-instance-cover").forEach((cover=>{Object.assign(cover.style,{height:content.offsetHeight+"px",left:content.offsetLeft+"px",top:content.offsetTop+"px",width:content.offsetWidth+"px"})}))}))}))},resizeTabPlayer.prototype.dragendHandler=function(){document.querySelectorAll(".videotime-tab-instance-cover").forEach((cover=>{cover.style.display="none"}))},resizeTabPlayer.prototype.dragstartHandler=function(e){e.target.classList.contains("videotimetab-resize-handle")&&(this.column=e.target.closest(".tab-pane").querySelector(".videotimetab-resize"),e.stopPropagation(),e.preventDefault(),document.querySelectorAll(".videotime-tab-instance-cover").forEach((cover=>{cover.style.display="block"})))},resizeTabPlayer.prototype.mousemoveHandler=function(e){document.querySelectorAll(".videotimetab-resize-handle").forEach((h=>{h.closest(".tab-pane")&&"block"==document.querySelector(".videotime-tab-instance-cover").style.display&&(this.column.style.width=e.pageX-this.column.getBoundingClientRect().left+"px")}))},resizeTabPlayer.prototype.cueVideo=function(e){if(e.target.matches('[data-action="cue"]')){let time=e.target.closest("a").getAttribute("data-start").match(/((([0-9]+):)?(([0-9]+):))?([0-9]+(\.[0-9]+))/),iframe=e.target.closest(".videotimetabs").querySelector(".vimeo-embed iframe"),player=new Player(iframe);e.preventDefault(),e.stopPropagation(),time&&player.setCurrentTime(3600*Number(time[3]||0)+60*Number(time[5]||0)+Number(time[6])).then(player.play.bind(player)).catch(Notification.exception)}},{init:function(){return new resizeTabPlayer}}}));

//# sourceMappingURL=resize_tab_player.min.js.map